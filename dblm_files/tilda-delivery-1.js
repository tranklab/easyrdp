var tcart_newDelivery={deliveryState:{currentRequest:null,projectId:null,city:{},services:{},searchboxes:{},focusoutTimers:{},cityCoordinates:null,ymapApiKey:null,cityGuid:null,streetGuid:null,currencyCode:null,pickupList:null,postalCode:null,staticCities:null,geoData:null,autocompleteData:{cities:null},badResponseCounters:{services:0},activeServiceUid:null,freeDeliveryThreshold:null,fullNames:{city:"",street:"",house:"",pickup:""}},init:function(ymapApiKey){window.tcart_newDeliveryActive=!0,this.deliveryState.projectId=parseInt($("#allrecords").attr("data-tilda-project-id"),10),this.deliveryState.projectId>0||1!==$("#t-header").length||(this.deliveryState.projectId=parseInt($("#t-header").attr("data-tilda-project-id"),10)),this.deliveryState.projectId>0||1!==$("#t-footer").length||(this.deliveryState.projectId=parseInt($("#t-footer").attr("data-tilda-project-id"),10)),this.deliveryState.projectId>0||1!==$("#tildacopy").length||(this.deliveryState.projectId=parseInt(($("#tildacopy").attr("data-tilda-sign")||"").split("#")[0],10)),this.deliveryState.currencyCode=$(".t706").attr("data-project-currency-code"),this.deliveryState.ymapApiKey=ymapApiKey,this.deliveryState.ymapApiKey&&this.mapAppendScript("",ymapApiKey);var that=this,deliveryWrapper=$(".t-radio__wrapper-delivery").first();$(".t-radio__wrapper-delivery").length>0&&$(".t-radio__wrapper-delivery").html(""),deliveryWrapper.attr("id","customdelivery");var deliveryTitle=tcart_newDelivery.createTitle(t_delivery_dict("delivery"));deliveryWrapper.append(deliveryTitle),this.appendStyleFromSettings(),$.when(this.getCityFromGeo(this.deliveryState.projectId)).then((function(data){if(data){var cityInput=tcart_newDelivery.createInput("",t_delivery_dict("city"),null,null,null,null,"searchbox-input load js-tilda-rule","tildadelivery-city",null,null,!0,null,"chosevalue"),searchbox=that.createSearchbox(cityInput,"city-searchbox"),postalCodeInput=tcart_newDelivery.createInput("","",null,null,null,null,"","tildadelivery-postalcode",!0),hashInput=tcart_newDelivery.createInput("","hash",null,null,null,null,"","tildadelivery-hash",!0),countryInput=tcart_newDelivery.createInput("","country",null,null,null,null,"","tildadelivery-country",!0);deliveryWrapper.append(postalCodeInput),deliveryWrapper.append(hashInput),deliveryWrapper.append(countryInput),deliveryWrapper.append(searchbox.outerHTML),that.searchboxInit("city-searchbox","city");var deliveryServicesWrapper=document.createElement("div"),cityData,citySearchInput;if(deliveryServicesWrapper.id="delivery-services-wrapper",deliveryWrapper.append(deliveryServicesWrapper),that.deliveryState.geoData=data,data.cities?(cityData=data.cities[0],that.deliveryState.staticCities=data.cities):cityData=data,cityData&&(that.deliveryState.city=cityData,that.deliveryState.cityGuid=cityData.guid,that.deliveryState.countryIso=cityData.countryIso,that.deliveryState.postalCode=cityData.postalCode,that.deliveryState.cityPostalCode=cityData.postalCode),""!==cityData.name)$("#city-searchbox").find(".t-input-description").html(cityData.fullName),$('[name="tildadelivery-country"]').val(cityData.countryIso),that.deliveryState.ymapApiKey&&$.when(that.getCityCoordinates("yandex",cityData.name)).done((function(data){var coordinates;try{(coordinates=data.response.GeoObjectCollection.featureMember[0].GeoObject.Point.pos.split(" "))&&(coordinates=[coordinates[1],coordinates[0]],that.deliveryState.cityCoordinates=coordinates)}catch(e){console.error(e)}})),that.deliveryState.searchboxes["city-searchbox"]||(that.deliveryState.searchboxes["city-searchbox"]={}),that.deliveryState.searchboxes["city-searchbox"].address=cityData,that.deliveryState.fullNames.city=cityData.fullName,$('input[name="tildadelivery-city"]').val(cityData.name),$('input[name="tildadelivery-city"]').attr("data-option-selected",!0),that.setPostalCodeInput(cityData.postalCode),that.renderServices(cityData.postalCode);else $(".t706 #city-searchbox input").removeClass("load").attr("readonly",!1)}}),(function(){var cityInput=tcart_newDelivery.createInput("hidden","","","nodelivery",null,null,"","delivery-badresponse-comment",null,null,!0,"","deliveryreq");window.tcart&&(window.tcart.system="none");var message='<div style="margin: 20px 0; line-height: 22px; color: red;" class="t-text">'+t_delivery_dict("unavailable")+"</div>";deliveryWrapper.append(message),deliveryWrapper.append(cityInput)})),window.isMobile?$("#customdelivery").on("click touchstart",".t-input",(function(event){var target=$(event.target),width;if(target.outerWidth(!0)-event.offsetX<=45&&target.closest(".t-input-block").hasClass("active")){var searchboxId=target.parent(".searchbox-wrapper").attr("id");$("#"+searchboxId).find(".searchbox-list").html("");var focusoutTimer=that.deliveryState.focusoutTimers[searchboxId];clearTimeout(focusoutTimer),target.val(""),target.closest(".t-input-block").removeClass("active"),setTimeout((function(){target.focus()}),50),that.deliveryState.searchboxes[searchboxId]&&that.deliveryState.searchboxes[searchboxId].address&&(that.deliveryState.searchboxes[searchboxId].address=null)}})):$("#customdelivery").on("click mousedown",".t-input-clear",(function(){var searchboxId=$(this).closest(".searchbox-wrapper").attr("id");$("#"+searchboxId).find(".searchbox-list").html("");var focusoutTimer=that.deliveryState.focusoutTimers[searchboxId];clearTimeout(focusoutTimer),$(this).siblings(".searchbox-input").val(""),$(this).closest(".t-input-block").removeClass("active"),$(this).siblings(".searchbox-input").focus(),that.deliveryState.searchboxes[searchboxId]&&that.deliveryState.searchboxes[searchboxId].address&&(that.deliveryState.searchboxes[searchboxId].address=null)})),$("#customdelivery").on("click mousedown",".searchbox-change-pickup",(function(){var searchbox;$(this).closest(".searchbox-wrapper").removeClass("show-info")})),this.renderFullAddressNode()},appendStyleFromSettings:function(){var ref=document.querySelector("script"),firstInput=$(".t706 .t-form__inputsbox .t-input-group").find('input[type="text"]').first(),inputStyleText="";if(firstInput.length){var firstInputNode=firstInput[0],isBorderBottomOnly;firstInput.hasClass("t-input_bbonly")&&(inputStyleText+="outline: none; padding-left: 0!important; padding-right: 0!important; border-top: 0!important; border-right: 0!important; border-left: 0!important; background-color: transparent!important; border-radius: 0!important;"),inputStyleText+=firstInputNode.style.cssText}else inputStyleText+="color: #000000; border: 1px solid #000000;";var inputStyleTag=document.createElement("style");inputStyleTag.innerHTML=".t706 .t-form__inputsbox #customdelivery .t-input {"+inputStyleText+"}",ref.parentNode.insertBefore(inputStyleTag,ref);var firstLabel=$(".t706 .t-form__inputsbox .t-input-group").find(".t-input-title").first();if(firstLabel.length){var firstInputLabelNode,labelStyleText="";labelStyleText+=firstLabel[0].style.cssText;var labelStyleTag=document.createElement("style");labelStyleTag.innerHTML=".t706 .t-form__inputsbox #customdelivery .t-input-title {"+labelStyleText+"}",ref.parentNode.insertBefore(labelStyleTag,ref)}},disableChoseServiceControls:function(){$('.t706 input[name="tildadelivery-type"]').attr("disabled","disabled")},enableChoseServiceControls:function(){$('.t706 input[name="tildadelivery-type"]').removeAttr("disabled")},getFullAddress:function(){var fullNames=this.deliveryState.fullNames,address="";return fullNames.pickup?address+=fullNames.city+", "+fullNames.pickup:fullNames.street?address+=fullNames.city+", "+fullNames.street:null===fullNames.pickup&&null===fullNames.street&&fullNames.house&&(address+=fullNames.city+","),fullNames.house&&(address+=" "+fullNames.house),address},renderFullAddressNode:function(){var addressNode=document.createElement("div");addressNode.classList.add("delivery-full-address"),addressNode.classList.add("t-descr");var ref=document.querySelector(".t706__cartwin-totalamount-info");$(ref).after(addressNode)},setFullAddress:function(address){var addressNode;document.querySelector(".delivery-full-address").innerHTML=address},changeCartInputsHandler:function(){var that=this;$(".t706 input").off("change",this.saveTcartDelivery),$(".t706 input").on("change",this.saveTcartDelivery)},saveTcartDelivery:function(){var keysForTcartDelivery=["city","street","pickup-name","pickup-address","pickup-id","house","entrance","floor","aptoffice","phone","entrancecode","comment","service-id","hash","postalcode","country","userinitials","onelineaddress"],keysForAutoComplete=["street","house","entrance","floor","aptoffice","phone","entrancecode","comment","postalcode","country","userinitials","onelineaddress"],cart=$(".t706");keysForTcartDelivery.forEach((function(key){var value="",inputName="tildadelivery-"+key;switch(key){case"service-id":value=cart.find('[name="tildadelivery-type"]:checked').attr("data-service-id");break;case"pickup-id":value=cart.find("[data-pickup-id]").attr("data-pickup-id");break;case"pickup-address":value=cart.find("[data-pickup-address]").attr("data-pickup-address");break;default:value=cart.find("[name="+inputName+"]").val()}void 0!==value&&""!==value&&void 0!==window.tcart.delivery&&(window.tcart.delivery[key]=value)})),void 0===window.deliveryUserFieldsAutoComplete&&(window.deliveryUserFieldsAutoComplete={}),keysForAutoComplete.forEach((function(key){var value="",inputName="tildadelivery-"+key;switch(key){case"service-id":value=cart.find('[name="tildadelivery-type"]:checked').attr("data-service-id");break;case"pickup-id":value=cart.find("[data-pickup-id]").attr("data-pickup-id");break;case"pickup-address":value=cart.find("[data-pickup-address]").attr("data-pickup-address");break;default:value=cart.find("[name="+inputName+"]").val()}void 0!==value&&""!==value&&void 0!==window.tcart.delivery&&(window.deliveryUserFieldsAutoComplete[key]=value)}))},restoreTcartDelivery:function(){var keys=["street","house","entrance","floor","aptoffice","phone","entrancecode","comment","postalcode","country","userinitials","onelineaddress"],cart=$(".t706"),userFields=window.deliveryUserFieldsAutoComplete;keys.forEach((function(key){var inputName="tildadelivery-"+key,el=cart.find("[name="+inputName+"]");void 0!==userFields&&void 0!==userFields[key]&&""!==userFields[key]&&1===el.length&&(el.val(userFields[key]),"street"===key&&tcart__inputErrorHandler.show(el,t_delivery_dict("selectAddress")))}))},mapAppendScript:function(type,ymapApiKey){var script=document.createElement("script");script.src="https://api-maps.yandex.ru/2.1/?apikey="+(ymapApiKey||"")+"&lang=ru_RU",$("head").append(script)},mapInit:function(type){switch(type){case"yandex":if(void 0!==window.ymaps){var mapWrapper=document.createElement("div");mapWrapper.id="delivery-yandex-map",$("#pickup-searchbox .searchbox-inner-wrapper").append(mapWrapper);var that=this;window.ymaps.ready((function(){window.deliveryMap=new ymaps.Map("delivery-yandex-map",{center:that.deliveryState.cityCoordinates||[55.76,37.64],zoom:8,controls:["zoomControl"],maxZoom:20},{yandexMapDisablePoiInteractivity:!0})}))}}},mapAddPoints:function(type,points,searchbox){var that=this;void 0!==window.ymaps&&window.ymaps.ready((function(){window.deliveryMap.geoObjects&&window.deliveryMap.geoObjects.removeAll();var pointsForCluster=[];if(points.forEach((function(point){0===point.coordinates[0]&&0===point.coordinates[1]||pointsForCluster.push(point.coordinates)})),pointsForCluster.length>0){for(var clusterer=new ymaps.Clusterer({preset:"islands#circleIcon",groupByCoordinates:!1,clusterDisableClickZoom:!1,clusterHideIconOnBalloonOpen:!1,geoObjectHideIconOnBalloonOpen:!1}),getPointData=function(index){var point=points[index],name=point.name,address=point.address||"",worktime=point.workTime||"",phones=point.phones||"",addressComment=point.addressComment||"",phonesLabel="",balloonContentHeader="";balloonContentHeader+="<b>"+name+"</b>";var balloonContentBody="";balloonContentBody+="<b>"+t_delivery_dict("address")+": </b>"+address+"</br>";var restrictions="";return point.cash&&"n"===point.cash&&(restrictions+="cash"),balloonContentBody+='<div style="margin: 10px 0;" class="delivery-map-point-select" '+(restrictions?'data-restrictions="'+restrictions+'"':"")+" data-point-index="+index+' onclick="window.tcart__chosePointOnMap(this); return false;">'+t_delivery_dict("select")+"</div>",balloonContentBody+=addressComment?addressComment+"</br>":"",balloonContentBody+=worktime?"<b>"+t_delivery_dict("workingHours")+": </b>"+worktime+"</br>":"",phones.length&&(balloonContentBody+=(phonesLabel=phones.length>1?"<b>"+t_delivery_dict("phones")+": </b>":"<b>"+t_delivery_dict("phone")+": </b>")+phones.join(", ")+"</br>"),window.tcart__chosePointOnMap=function(button){i=button.dataset.pointIndex;var point=points[i],searchInput=searchbox.find(".searchbox-input"),searchboxId=searchbox.attr("id");tcart__inputErrorHandler.hide(searchInput),that.deliveryState.searchboxes[searchboxId]||(that.deliveryState.searchboxes[searchboxId]={}),searchInput.attr("data-option-selected",!0),that.deliveryState.fullNames.pickup=point.address,that.deliveryState.postalCode=point.postalCode,that.setPostalCodeInput(point.postalCode),that.changePickupHandler(point.id,point.name,point.postalCode,searchbox,point.address),$('.t706 [name="tildadelivery-pickup-name"]').val(point.name),that.saveTcartDelivery(),window.deliveryMap.balloon.close(),that.showPickupInfo(point.id,searchbox),that.hidePaymentMethod(button)},{balloonContentHeader:balloonContentHeader,balloonContentBody:balloonContentBody,balloonContentFooter:""}},getPointOptions=function(index){return{preset:"islands#circleIcon",index:index}},geoObjects=[],i=0,len=pointsForCluster.length;i<len;i++)geoObjects[i]=new ymaps.Placemark(pointsForCluster[i],getPointData(i),getPointOptions(i));clusterer.options.set({gridSize:80,clusterDisableClickZoom:!1}),clusterer.add(geoObjects),window.deliveryMap.geoObjects.add(clusterer),window.deliveryMap.setBounds(clusterer.getBounds(),{checkZoomRange:!0}).then((function(){window.deliveryMap.getZoom()>20&&window.deliveryMap.setZoom(18)}),this)}}))},setPostalAndHash:function(value){var cart=$(".t706");cart.find('input[name="tildadelivery-postalcode"]').val(value),cart.find('input[name="tildadelivery-hash"]').val(value)},setPostalCodeInput:function(value){var cart;$(".t706").find('input[name="tildadelivery-postalcode"]').val(value)},setHashInput:function(value){var cart;$(".t706").find('input[name="tildadelivery-hash"]').val(value)},createSearchbox:function(input,id){var searchboxWrapper=document.createElement("div");searchboxWrapper.classList.add("searchbox-wrapper"),searchboxWrapper.setAttribute("id",id);var searchboxInnerWrapper=document.createElement("div");searchboxInnerWrapper.classList.add("searchbox-inner-wrapper"),$(searchboxInnerWrapper).append(input);var searchboxList=document.createElement("div");searchboxList.classList.add("searchbox-list"),searchboxList.setAttribute("tabindex",-1),$(searchboxInnerWrapper).append(searchboxList),$(searchboxWrapper).append(searchboxInnerWrapper);var searchboxInfo=document.createElement("div");return searchboxInfo.classList.add("searchbox-info"),searchboxInfo.setAttribute("tabindex",-1),$(searchboxWrapper).append(searchboxInfo),searchboxWrapper},searchboxInit:function(searchboxId,searchboxType){var searchbox=$("#"+searchboxId),searchInput=$(searchbox).find(".searchbox-input"),inputWrapper=searchInput.closest(".t-input-block"),that=this,changeTimeout;$(searchInput).on("paste keyup",(function(e){var event=e;clearTimeout(changeTimeout),that.deliveryState.searchboxes[searchboxId]&&(that.deliveryState.searchboxes[searchboxId].address=null),that.deliveryState.searchboxes[searchboxId]&&"pickup"!==searchboxType&&(that.deliveryState.searchboxes[searchboxId].autocompleteAddress=null),""===searchInput.val()||inputWrapper.hasClass("active")||inputWrapper.addClass("active"),changeTimeout=setTimeout((function(){that.changeSearchboxInputHandler(event,searchbox,searchboxType),changeTimeout=null}),500)})),$(searchInput).on("focusout",(function(){clearTimeout(changeTimeout),that.focusoutSearchboxInputHandler(searchbox,searchboxType)})),$(searchInput).on("click mousedown keyup",(function(event){t_throttle(that.clickSearchboxInputHandler(event,searchbox,searchboxType))}))},clickSearchboxInputHandler:function(event,searchbox,searchboxType){var searchInput=$(searchbox).find(".searchbox-input"),inputWrapper=searchInput.closest(".t-input-block");if(""===searchInput.val()||inputWrapper.hasClass("active")||inputWrapper.addClass("active"),$(searchbox).find(".searchbox-list-item").length>0)$(searchbox).find(".searchbox-list").show();else if(!searchInput.hasClass("load")){var isAddressStrong;searchbox.unbind();var serviceId=parseInt(searchInput.attr("data-service-id"),10);serviceId&&(isAddressStrong=this.deliveryState.services[serviceId].strongAddress);var that=this,searchList=$(searchbox).find(".searchbox-list"),searchboxId=searchbox.attr("id");this.deliveryState.searchboxes[searchboxId]&&"pickup"!==searchboxType&&(this.deliveryState.searchboxes[searchboxId].autocompleteAddress=null);var pattern=(event.target.value||"").trim(),ajaxData,deliveryServiceId,data;switch(searchbox.hasClass("load")||searchbox.addClass("load").attr("readonly",!0),searchboxType){case"city":if(""===pattern)return searchList.html('<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+t_delivery_dict("noResult")+"</div>"),searchList.show(),void searchbox.removeClass("load").attr("readonly",!1);if(ajaxData={pattern:pattern},ajaxData=JSON.stringify(ajaxData),that.deliveryState.searchboxes[searchboxId]&&(that.deliveryState.searchboxes[searchboxId].autocompleteAddress||that.deliveryState.staticCities)){if(searchbox.removeClass("load").attr("readonly",!1),(data=that.deliveryState.staticCities||that.deliveryState.searchboxes[searchboxId].autocompleteAddress).error||0===data.length)return void(""!==searchInput.val()?searchList.html('<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+t_delivery_dict("noResult")+"</div>"):searchList.html(""));searchList.show(),that.deliveryState.searchboxes[searchboxId].autocompleteAddress=data[0],that.deliveryState.searchboxes[searchboxId].addresses=data,that.deliveryState.autocompleteData.cities=data,that.fillSearchList(searchList,data,"address"),that.choseSearchListItemHandler(searchbox,searchboxType)}else $.when(that.getAddresses(ajaxData,searchboxType)).done((function(addresses){searchbox.removeClass("load").attr("readonly",!1),addresses.error||0===addresses.length?""!==searchInput.val()?searchList.html('<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+t_delivery_dict("noResult")+"</div>"):searchList.html(""):(searchList.show(),that.deliveryState.searchboxes[searchboxId].autocompleteAddress=addresses[0],that.deliveryState.searchboxes[searchboxId].addresses=addresses,that.deliveryState.autocompleteData.cities=addresses,that.fillSearchList(searchList,addresses,"address"),that.choseSearchListItemHandler(searchbox,searchboxType))}));break;case"pickup":deliveryServiceId=$(searchInput).attr("data-service-id");var restrictions=$('.t-radio_delivery[data-service-id="'+deliveryServiceId+'"]:checked').attr("data-restrictions")||"";if(that.deliveryState.searchboxes[searchboxId]&&that.deliveryState.searchboxes[searchboxId].autocompleteAddress){if(searchbox.removeClass("load").attr("readonly",!1),(data=that.deliveryState.searchboxes[searchboxId].autocompleteAddress).error||0===data.length){searchList.html("");var lang=window.tildaBrowserLang.toLowerCase(),userFriendlyError=data.userFriendlyError?data.userFriendlyError[lang]?data.userFriendlyError[lang]:data.userFriendlyError.en:"";return void(data.error&&tcart__errorHandler.show(userFriendlyError||data.error))}data=(data=data.filter((function(item){return-1!==item.name.toLowerCase().indexOf(pattern.toLowerCase())||-1!==item.address.toLowerCase().indexOf(pattern.toLowerCase())}))).map((function(item){return"cash"===restrictions&&(item.cash="n"),item})),that.deliveryState.searchboxes[searchboxId]||(that.deliveryState.searchboxes[searchboxId]={}),that.fillSearchList(searchList,data,"pickup"),that.choseSearchListItemHandler(searchbox,searchboxType)}else $.when(that.getPickupList(that.deliveryState.projectId,that.deliveryState.city.postalCode,deliveryServiceId,pattern)).done((function(data){if(searchbox.removeClass("load").attr("readonly",!1),data.error||0===data.length){""!==searchInput.val()?searchList.html('<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+t_delivery_dict("noResult")+"</div>"):searchList.html("");var lang=window.tildaBrowserLang.toLowerCase(),userFriendlyError=data.userFriendlyError?data.userFriendlyError[lang]?data.userFriendlyError[lang]:data.userFriendlyError.en:"";data.error&&tcart__errorHandler.show(userFriendlyError||data.error)}else that.deliveryState.searchboxes[searchboxId]||(that.deliveryState.searchboxes[searchboxId]={}),that.deliveryState.searchboxes[searchboxId].autocompleteAddress=data,that.deliveryState.pickupList=data,that.fillSearchList(searchList,data,"pickup"),that.choseSearchListItemHandler(searchbox,searchboxType)}));break;case"street":ajaxData={pattern:pattern,fias:this.deliveryState.cityGuid},ajaxData=JSON.stringify(ajaxData),that.deliveryState.searchboxes[searchboxId]||(that.deliveryState.searchboxes[searchboxId]={}),isAddressStrong&&"street"===searchboxType&&searchInput.attr("data-option-selected",!1),$.when(that.getAddresses(ajaxData,searchboxType)).done((function(addresses){searchbox.removeClass("load").attr("readonly",!1),addresses.error||0===addresses.length?""!==searchInput.val()?searchList.html('<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+t_delivery_dict("noResult")+"</div>"):searchList.html(""):(that.deliveryState.searchboxes[searchboxId].autocompleteAddress=addresses[0],that.fillSearchList(searchList,addresses,"address"),that.choseSearchListItemHandler(searchbox,searchboxType))}));break;case"house":ajaxData={pattern:pattern,fias:this.deliveryState.streetGuid||this.deliveryState.cityGuid},ajaxData=JSON.stringify(ajaxData),$.when(that.getAddresses(ajaxData,searchboxType)).done((function(data){searchbox.removeClass("load").attr("readonly",!1),data.error||0===data.length?searchList.html(""):(that.deliveryState.searchboxes[searchboxId]||(that.deliveryState.searchboxes[searchboxId]={}),that.deliveryState.searchboxes[searchboxId].autocompleteAddress=data[0],that.fillSearchList(searchList,data,"address"),that.choseSearchListItemHandler(searchbox,searchboxType))}));break;default:searchbox.removeClass("load").attr("readonly",!1)}}},changeSearchboxInputHandler:function(e,searchbox,searchboxType){searchbox.unbind();var that=this,searchList=$(searchbox).find(".searchbox-list"),searchInput=$(searchbox).find(".searchbox-input"),inputWrapper=searchInput.closest(".t-input-block"),searchboxId=searchbox.attr("id"),serviceId=parseInt(searchInput.attr("data-service-id")),isAddressStrong;if(serviceId&&(isAddressStrong=this.deliveryState.services[serviceId].strongAddress),!searchInput.hasClass("load")){var pattern=(e.target.value||"").trim(),ajaxData,data;switch(searchbox.hasClass("load")||searchbox.addClass("load").attr("readonly",!0),""==searchInput.val()&&inputWrapper.removeClass("active"),searchboxType){case"city":if(ajaxData={pattern:pattern},ajaxData=JSON.stringify(ajaxData),that.deliveryState.searchboxes[searchboxId]||(that.deliveryState.searchboxes[searchboxId]={}),that.deliveryState.searchboxes[searchboxId]&&that.deliveryState.staticCities){if(searchbox.removeClass("load").attr("readonly",!1),data=that.deliveryState.staticCities,Array.isArray(data)?data=data.filter((function(item){return-1!==item.name.toLowerCase().indexOf(pattern.toLowerCase())||-1!==item.fullName.toLowerCase().indexOf(pattern.toLowerCase())})):console.log(data),0===data.length)return void(""!==searchInput.val()?searchList.html('<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+t_delivery_dict("noResult")+"</div>"):searchList.html(""));that.deliveryState.searchboxes[searchboxId].autocompleteAddress=data[0],that.deliveryState.searchboxes[searchboxId].addresses=data,that.deliveryState.autocompleteData.cities=data,that.fillSearchList(searchList,data,"address"),that.choseSearchListItemHandler(searchbox,searchboxType)}else $.when(that.getAddresses(ajaxData,searchboxType)).done((function(addresses){searchbox.removeClass("load").attr("readonly",!1),addresses.error||0===addresses.length?""!==searchInput.val()?searchList.html('<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+t_delivery_dict("noResult")+"</div>"):searchList.html(""):(that.deliveryState.searchboxes[searchboxId].autocompleteAddress=addresses[0],that.deliveryState.searchboxes[searchboxId].addresses=addresses,that.deliveryState.autocompleteData.cities=addresses,that.fillSearchList(searchList,addresses,"address"),that.choseSearchListItemHandler(searchbox,searchboxType))}));break;case"pickup":if(searchInput.attr("data-option-selected",!1),that.deliveryState.searchboxes[searchboxId]&&that.deliveryState.searchboxes[searchboxId].autocompleteAddress){if(searchbox.removeClass("load").attr("readonly",!1),0===(data=(data=that.deliveryState.searchboxes[searchboxId].autocompleteAddress).filter((function(item){return-1!==item.name.toLowerCase().indexOf(pattern.toLowerCase())||-1!==item.address.toLowerCase().indexOf(pattern.toLowerCase())}))).length)return void(""!==searchInput.val()?searchList.html('<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+t_delivery_dict("noResult")+"</div>"):searchList.html(""));that.fillSearchList(searchList,data,"pickup"),that.choseSearchListItemHandler(searchbox,searchboxType)}break;case"street":ajaxData={pattern:pattern,fias:this.deliveryState.cityGuid},ajaxData=JSON.stringify(ajaxData),that.deliveryState.searchboxes[searchboxId]||(that.deliveryState.searchboxes[searchboxId]={}),isAddressStrong&&searchInput.attr("data-option-selected",!1),$.when(that.getAddresses(ajaxData,searchboxType)).done((function(addresses){searchbox.removeClass("load").attr("readonly",!1),addresses.error||0===addresses.length?""!==searchInput.val()?searchList.html('<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+t_delivery_dict("noResult")+"</div>"):searchList.html(""):(that.deliveryState.searchboxes[searchboxId].autocompleteAddress=addresses[0],that.deliveryState.searchboxes[searchboxId].addresses=addresses,that.fillSearchList(searchList,addresses,"address"),that.choseSearchListItemHandler(searchbox,searchboxType))}));break;case"house":ajaxData={pattern:pattern,fias:this.deliveryState.streetGuid||this.deliveryState.cityGuid},ajaxData=JSON.stringify(ajaxData),that.deliveryState.searchboxes[searchboxId]||(that.deliveryState.searchboxes[searchboxId]={}),$.when(that.getAddresses(ajaxData,searchboxType)).done((function(addresses){searchbox.removeClass("load").attr("readonly",!1),addresses.error||0===addresses.length?""!==searchInput.val()?searchList.html('<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+t_delivery_dict("noResult")+"</div>"):searchList.html(""):(that.deliveryState.searchboxes[searchboxId].autocompleteAddress=addresses[0],that.deliveryState.searchboxes[searchboxId].addresses=addresses,that.fillSearchList(searchList,addresses,"address"),that.choseSearchListItemHandler(searchbox,searchboxType))}))}}},choseSearchListItemHandler:function(searchbox,searchboxType){var searchboxId=searchbox.attr("id"),searchInput=$(searchbox).find(".searchbox-input"),searchboxDescriptionInput=$(searchbox).find(".t-input-description"),searchList=$(searchbox).find(".searchbox-list"),searchListItem=$(searchbox).find(".searchbox-list-item"),postalCode,that=this,focusoutTimer,serviceId,inputWrapper=searchInput.closest(".t-input-block");tcart__inputErrorHandler.hide(searchInput);var clicked=!1;searchListItem.on("click mousedown",(function(e){if(!clicked){switch(clicked=!0,inputWrapper.removeClass("active"),focusoutTimer=that.deliveryState.focusoutTimers[searchboxId],clearTimeout(focusoutTimer),postalCode=e.target.dataset.postalcode,that.deliveryState.postalCode=postalCode,that.setPostalCodeInput(postalCode),that.deliveryState.searchboxes[searchboxId]||(that.deliveryState.searchboxes[searchboxId]={}),searchboxType){case"city":searchInput.addClass("load").attr("readonly",!0),tcart__errorHandler.hide(),searchInput.val(e.target.dataset.name),searchboxDescriptionInput.html(e.target.dataset.fullName),$('.t706 [name="tildadelivery-country"]').val(e.target.dataset.countryIso),searchInput.attr("data-guid",e.target.dataset.guid),that.deliveryState.ymapApiKey&&$.when(that.getCityCoordinates("yandex",e.target.dataset.name)).done((function(data){var coordinates;try{(coordinates=data.response.GeoObjectCollection.featureMember[0].GeoObject.Point.pos.split(" "))&&(coordinates=[coordinates[1],coordinates[0]],that.deliveryState.cityCoordinates=coordinates)}catch(e){console.error(e)}})),that.deliveryState.searchboxes[searchboxId].address={name:e.target.dataset.name,postalCode:postalCode,guid:e.target.dataset.guid},that.deliveryState.city={name:e.target.dataset.name,fullName:e.target.dataset.fullName,postalCode:postalCode,guid:e.target.dataset.guid},that.deliveryState.cityPostalCode=postalCode;var cityGeoData=that.deliveryState.autocompleteData.cities.find((function(element){return element.guid==e.target.dataset.guid}));that.deliveryState.geoData=cityGeoData,that.deliveryState.cityGuid=e.target.dataset.guid,that.deliveryState.streetGuid=null,that.deliveryState.fullNames={},that.deliveryState.fullNames.city=e.target.dataset.fullName,$("#delivery-services-wrapper").html(""),that.renderServices(postalCode),searchList.hide();break;case"street":serviceId=parseInt(searchInput.attr("data-service-id")),searchInput.val(e.target.dataset.shortname),searchInput.attr("data-guid",e.target.dataset.guid),postalCode=postalCode||that.deliveryState.city.postalCode,that.deliveryState.searchboxes[searchboxId].address={name:e.target.dataset.name,shortName:e.target.dataset.shortname,postalCode:postalCode,guid:e.target.dataset.guid},that.deliveryState.streetGuid=e.target.dataset.guid,that.deliveryState.fullNames.street=e.target.dataset.shortname,that.deliveryState.fullNames.house=null,that.clearHouseInput(),window.tcart.emptyDeliveryServices=!0,tcart__updateDelivery(),$.when(that.getDeliveryPrice(that.deliveryState.projectId,postalCode,serviceId)).done((function(data){if(data.error||0===data.length){var lang=window.tildaBrowserLang.toLowerCase(),userFriendlyError=data.userFriendlyError?data.userFriendlyError[lang]?data.userFriendlyError[lang]:data.userFriendlyError.en:"";return data.error&&tcart__errorHandler.show(userFriendlyError||data.error),window.tcart.emptyDeliveryServices=!0,void tcart__updateDelivery()}if(window.tcart.emptyDeliveryServices=!1,tcart__errorHandler.hide(),void 0!==data.hash&&that.setHashInput(data.hash),void 0!==data.price){var servicePrice=data.price;that.updatePriceValueInRadio(servicePrice,serviceId)}that.setFullAddress(that.getFullAddress()),tcart__showDeliveryPrice()})).fail((function(){var error="";error="RU"===window.browserLang?'Невозможно получить почтовый индекс для доставки. Пожалуйста, перезагрузите страницу и попробуйте еще раз. Если ситуация не изменилась, обратитесь в поддержку <a href="mailto:team@tilda.cc?subject=Unable to get a postal code for street" style="color:#fff;text-decoration:underline;">team@tilda.cc</a>.':'Unable to get a postal code for delivery. Please reload the page and try again. If the situation has not changed, please contact support <a href="mailto:team@tilda.cc?subject=Unable to get a postal code for street" style="color:#fff;text-decoration:underline;">team@tilda.cc</a>.',tcart__errorHandler.show("Request failed: "+error),window.tcart.emptyDeliveryServices=!0,tcart__updateDelivery()})),searchList.html("");break;case"pickup":var coordinates=e.target.dataset.coordinates.split(",");that.hidePaymentMethod(e.target),that.changePickupHandler(e.target.dataset.pickupid,e.target.dataset.name,postalCode,searchbox,e.target.dataset.address,coordinates),that.deliveryState.searchboxes[searchboxId].address={name:e.target.dataset.name,pickupid:e.target.dataset.pickupid,postalCode:postalCode},that.deliveryState.fullNames[searchboxType]=e.target.dataset.address,that.showPickupInfo(e.target.dataset.pickupid,searchbox),searchList.html("");break;case"house":serviceId=parseInt(searchInput.attr("data-service-id")),searchInput.val(e.target.dataset.name),postalCode=postalCode||that.deliveryState.city.postalCode,that.deliveryState.searchboxes[searchboxId].address={postalCode:postalCode},that.deliveryState.fullNames[searchboxType]=e.target.dataset.name,window.tcart.emptyDeliveryServices=!0,tcart__updateDelivery(),$.when(that.getDeliveryPrice(that.deliveryState.projectId,postalCode,serviceId)).done((function(data){if(data.error||0===data.length){var lang=window.tildaBrowserLang.toLowerCase(),userFriendlyError=data.userFriendlyError?data.userFriendlyError[lang]?data.userFriendlyError[lang]:data.userFriendlyError.en:"";return tcart__errorHandler.show(userFriendlyError||data.error),window.tcart.emptyDeliveryServices=!0,tcart__updateDelivery(),void that.removePriceValueInRadio(serviceId)}if(window.tcart.emptyDeliveryServices=!1,tcart__errorHandler.hide(),void 0!==data.hash&&that.setHashInput(data.hash),void 0!==data.price){var servicePrice=data.price;that.updatePriceValueInRadio(servicePrice,serviceId)}that.setFullAddress(that.getFullAddress()),tcart__showDeliveryPrice()})).fail((function(){var error="";error="RU"===window.browserLang?'Невозможно получить почтовый индекс для доставки. Пожалуйста, перезагрузите страницу и попробуйте еще раз. Если ситуация не изменилась, обратитесь в поддержку <a href="mailto:team@tilda.cc?subject=Unable to get a postal code for house" style="color:#fff;text-decoration:underline;">team@tilda.cc</a>.':'Unable to get a postal code for delivery. Please reload the page and try again. If the situation has not changed, please contact support <a href="mailto:team@tilda.cc?subject=Unable to get a postal code for house" style="color:#fff;text-decoration:underline;">team@tilda.cc</a>.',tcart__errorHandler.show("Request failed: "+error),window.tcart.emptyDeliveryServices=!0,tcart__updateDelivery()})),searchList.html("")}searchInput.attr("data-option-selected",!0),setTimeout((function(){clicked=!1}),200)}}))},focusoutSearchboxInputHandler:function(searchbox,searchboxType){var that=this,postalCode,searchList=$(searchbox).find(".searchbox-list"),searchboxDescriptionInput=$(searchbox).find(".t-input-description"),searchboxId=searchbox.attr("id"),searchInput=$(searchbox).find(".searchbox-input"),inputWrapper=searchInput.closest(".t-input-block"),data,serviceId=parseInt(searchInput.attr("data-service-id"),10),isAddressStrong;serviceId&&""!==searchList.html()?(isAddressStrong=this.deliveryState.services[serviceId].strongAddress,searchInput.attr("data-option-selected",!1)):searchInput.attr("data-option-selected",!0),this.deliveryState.focusoutTimers[searchboxId]=setTimeout((function(){if(inputWrapper.removeClass("active"),that.deliveryState.searchboxes[searchboxId]&&that.deliveryState.searchboxes[searchboxId].address)return tcart__inputErrorHandler.hide(searchInput),void("city"===searchboxType?searchList.hide():searchList.html(""));switch(searchboxType){case"city":if(that.deliveryState.searchboxes[searchboxId]&&that.deliveryState.searchboxes[searchboxId].autocompleteAddress&&searchInput.val()===that.deliveryState.searchboxes[searchboxId].autocompleteAddress.name){searchInput.addClass("load").attr("readonly",!0),data=that.deliveryState.searchboxes[searchboxId].autocompleteAddress,that.deliveryState.searchboxes[searchboxId].address=data,tcart__inputErrorHandler.hide(searchInput),that.deliveryState.ymapApiKey&&$.when(that.getCityCoordinates("yandex",data.name)).done((function(data){var coordinates;try{(coordinates=data.response.GeoObjectCollection.featureMember[0].GeoObject.Point.pos.split(" "))&&(coordinates=[coordinates[1],coordinates[0]],that.deliveryState.cityCoordinates=coordinates)}catch(e){console.error(e)}})),postalCode=data.postalCode,that.deliveryState.postalCode=postalCode,that.setPostalCodeInput(postalCode),$('[name="tildadelivery-country"]').val(data.countryIso),searchInput.val(data.name),searchboxDescriptionInput.html(data.fullName),searchInput.attr("data-guid",data.guid),that.deliveryState.city.name=data.name,that.deliveryState.city.fullName=data.fullName,that.deliveryState.city.postalCode=postalCode,that.deliveryState.city.guid=data.guid,that.deliveryState.cityPostalCode=postalCode,that.deliveryState.cityGuid=data.guid,that.deliveryState.streetGuid=null,that.deliveryState.fullNames={},that.deliveryState.fullNames[searchboxType]=data.fullName;var cityGeoData=that.deliveryState.autocompleteData.cities.find((function(element){return element.guid==data.guid}));that.deliveryState.geoData=cityGeoData,$("#delivery-services-wrapper").html(""),searchList.hide(),that.renderServices(postalCode),searchInput.attr("data-option-selected",!0)}else searchList.html(""),searchboxDescriptionInput.html(""),$("#delivery-services-wrapper").html(""),$("#addresses-wrapper").remove(),searchInput.attr("data-option-selected",!1),that.deliveryState.streetGuid=null,that.deliveryState.fullNames={},tcart__inputErrorHandler.show(searchInput,t_delivery_dict("selectCity"));break;case"street":that.deliveryState.searchboxes[searchboxId]&&that.deliveryState.searchboxes[searchboxId].autocompleteAddress&&searchInput.val()===that.deliveryState.searchboxes[searchboxId].autocompleteAddress.shortName?(data=that.deliveryState.searchboxes[searchboxId].autocompleteAddress,that.deliveryState.searchboxes[searchboxId].address=data,that.deliveryState.fullNames[searchboxType]=data.shortName,tcart__inputErrorHandler.hide(searchInput),postalCode=data.postalCode,that.deliveryState.postalCode=postalCode,searchInput.val(data.shortName),searchInput.attr("data-guid",data.guid),that.deliveryState.streetGuid=data.guid,that.setPostalCodeInput(postalCode),searchInput.attr("data-option-selected",!0),searchList.html(""),$.when(that.getDeliveryPrice(that.deliveryState.projectId,postalCode,serviceId)).done((function(data){if(data.error||0===data.length){var lang=window.tildaBrowserLang.toLowerCase(),userFriendlyError=data.userFriendlyError?data.userFriendlyError[lang]?data.userFriendlyError[lang]:data.userFriendlyError.en:"";data.error&&tcart__errorHandler.show(userFriendlyError||data.error)}else{if(void 0!==data.hash&&that.setHashInput(data.hash),void 0!==data.price){var servicePrice=data.price;that.updatePriceValueInRadio(servicePrice,serviceId)}that.setFullAddress(that.getFullAddress()),tcart__showDeliveryPrice()}})).fail((function(){var error="";error="RU"===window.browserLang?'Невозможно получить почтовый индекс для доставки. Пожалуйста, перезагрузите страницу и попробуйте еще раз. Если ситуация не изменилась, обратитесь в поддержку <a href="mailto:team@tilda.cc?subject=Unable to get a postal code for street" style="color:#fff;text-decoration:underline;">team@tilda.cc</a>.':'Unable to get a postal code for delivery. Please reload the page and try again. If the situation has not changed, please contact support <a href="mailto:team@tilda.cc?subject=Unable to get a postal code for street" style="color:#fff;text-decoration:underline;">team@tilda.cc</a>.',tcart__errorHandler.show("Request failed: "+error),window.tcart.emptyDeliveryServices=!0,tcart__updateDelivery()}))):(isAddressStrong&&(searchInput.attr("data-option-selected",!1),searchList.html(""),tcart__inputErrorHandler.show(searchInput,t_delivery_dict("selectAddress"))),searchList.html("")),that.deliveryState.fullNames.house=null,that.clearHouseInput();break;case"house":that.deliveryState.searchboxes[searchboxId]&&that.deliveryState.searchboxes[searchboxId].autocompleteAddress&&searchInput.val()===that.deliveryState.searchboxes[searchboxId].autocompleteAddress.name?(data=that.deliveryState.searchboxes[searchboxId].autocompleteAddress,that.deliveryState.searchboxes[searchboxId].address=data,that.deliveryState.fullNames[searchboxType]=data.name,tcart__inputErrorHandler.hide(searchInput),postalCode=data.postalCode,that.deliveryState.postalCode=postalCode,searchInput.val(data.name),searchInput.attr("data-option-selected",!0),that.setPostalCodeInput(postalCode),searchList.html(""),$.when(that.getDeliveryPrice(that.deliveryState.projectId,postalCode,serviceId)).done((function(data){if(data.error||0===data.length){var lang=window.tildaBrowserLang.toLowerCase(),userFriendlyError=data.userFriendlyError?data.userFriendlyError[lang]?data.userFriendlyError[lang]:data.userFriendlyError.en:"";data.error&&tcart__errorHandler.show(userFriendlyError||data.error)}else{if(void 0!==data.hash&&that.setHashInput(data.hash),void 0!==data.price){var servicePrice=data.price;that.updatePriceValueInRadio(servicePrice,serviceId)}that.setFullAddress(that.getFullAddress()),tcart__showDeliveryPrice()}})).fail((function(){var error="";error="RU"===window.browserLang?'Невозможно получить почтовый индекс для доставки. Пожалуйста, перезагрузите страницу и попробуйте еще раз. Если ситуация не изменилась, обратитесь в поддержку <a href="mailto:team@tilda.cc?subject=Unable to get a postal code for house" style="color:#fff;text-decoration:underline;">team@tilda.cc</a>.':'Unable to get a postal code for delivery. Please reload the page and try again. If the situation has not changed, please contact support <a href="mailto:team@tilda.cc?subject=Unable to get a postal code for house" style="color:#fff;text-decoration:underline;">team@tilda.cc</a>.',tcart__errorHandler.show("Request failed: "+error),window.tcart.emptyDeliveryServices=!0,tcart__updateDelivery()}))):searchList.html("");break;case"pickup":searchList.html("");var autocompleteAddress=null,equalAddress=null;that.deliveryState.searchboxes[searchboxId]&&that.deliveryState.searchboxes[searchboxId].autocompleteAddress&&(autocompleteAddress=data=that.deliveryState.searchboxes[searchboxId].autocompleteAddress).forEach((function(address){address.name===searchInput.val()&&(equalAddress=address)})),autocompleteAddress&&equalAddress?(data=equalAddress,that.deliveryState.searchboxes[searchboxId].address=data,that.deliveryState.fullNames[searchboxType]=data.address,tcart__inputErrorHandler.hide(searchInput),searchInput.attr("data-option-selected",!0),that.changePickupHandler(data.id,data.name,data.postalCode,searchbox,data.address,data.coordinates),that.setPostalCodeInput(data.postalCode),that.deliveryState.postalCode=data.postalCode,searchList.html("")):(searchInput.attr("data-option-selected",!1),tcart__inputErrorHandler.show(searchInput,t_delivery_dict("selectAddress")))}}),200)},fillSearchList:function(searchList,data,type){var newWrap=document.createElement("div"),searchListItemDescription,titleText,descriptionText;data.forEach((function(address){var searchListItem=document.createElement("div");switch($(searchListItem).addClass("searchbox-list-item t-text"),type){case"pickup":titleText=address.name,descriptionText=address.address;var restrictions="";address.cash&&"n"===address.cash&&(restrictions+="cash"),searchListItem.dataset.restrictions=restrictions;break;case"address":if(address.fullName){titleText=address.fullName.split(",").reverse()[0];var fullNameValue=address.fullName;(fullNameValue=fullNameValue.split(",").reverse()).shift(),fullNameValue=fullNameValue.join(", "),descriptionText=fullNameValue}else titleText=address.name,descriptionText=""}searchListItem.dataset.name=address.name,searchListItem.dataset.fullName=address.fullName||"",searchListItem.dataset.postalcode=address.postalCode,searchListItem.dataset.guid=address.guid||"",searchListItem.dataset.pickupid=address.id||"",searchListItem.dataset.shortname=address.shortName||"",searchListItem.dataset.address=address.address||"",searchListItem.dataset.coordinates=address.coordinates||"",searchListItem.dataset.countryIso=address.countryIso||"";var searchListItemText=document.createElement("div");searchListItemText.classList.add("searchbox-list-item-text"),searchListItemText.innerHTML=titleText,$(searchListItem).append(searchListItemText),(searchListItemDescription=document.createElement("div")).classList.add("searchbox-list-item-description"),searchListItemDescription.innerHTML=descriptionText,$(searchListItem).append(searchListItemDescription),$(newWrap).append(searchListItem)})),searchList.html(newWrap.outerHTML),searchList.scrollTop(0)},showPickupInfo:function(pickupId,searchbox){var searchboxInfo=$(searchbox).find(".searchbox-info"),pickupData;searchbox.addClass("show-info"),this.deliveryState.pickupList.forEach((function(pickupItem){pickupItem.id!=pickupId||(pickupData=pickupItem)}));var name=pickupData.name,address=pickupData.address||"",worktime=pickupData.workTime||"",phones=pickupData.phones||"",addressComment=pickupData.addressComment||"",infoContent="";infoContent+='<p style="font-weight: 400; margin-bottom: 15px;" class="t-text">'+t_delivery_dict("pickup")+":</p>",infoContent+='<p class="t-text">'+name+"</p>",infoContent+='<p class="t-text">'+t_delivery_dict("address")+": "+address+"</p>",addressComment&&(infoContent+='<p class="t-text" style="opacity: 0.6; line-height: 22px; font-size: .9rem;">'+addressComment+"</p>"),infoContent+=worktime?'<p class="t-text">'+t_delivery_dict("workingHours")+": "+worktime+"</p>":"",phones.length&&(infoContent+=phones.length>1?'<p class="t-text">'+t_delivery_dict("phones")+": "+phones.join(", ")+"</p>":'<p class="t-text">'+t_delivery_dict("phone")+": "+phones.join(", ")+"</p>"),infoContent+='<span style="border-bottom: 1px dashed #000; font-weight: 400; margin-top: 10px; display: inline-block; cursor: pointer;" class="t-text searchbox-change-pickup">'+t_delivery_dict("change")+"</span>",searchboxInfo.html(infoContent)},declOfNum:function(number,titles){var cases;return titles[number%100>4&&number%100<20?2:[2,0,1,1,1,2][number%10<5?number%10:5]]},renderServices:function(postalCode){this.deliveryState.services={},this.deliveryState.postalCode={},$("#delivery-services-wrapper").html(""),$("#addresses-wrapper").remove();var cityPostalCode=this.deliveryState.cityPostalCode||"",that=this,currencyCode=this.deliveryState.currencyCode,citySearchInput=$(".t706 #city-searchbox input"),wrapper=$(".t-radio__wrapper-delivery").first();$.when(this.getServices(this.deliveryState.projectId,cityPostalCode,currencyCode)).then((function(data){if(data.error){var lang=window.tildaBrowserLang.toLowerCase(),userFriendlyError=data.userFriendlyError?data.userFriendlyError[lang]?data.userFriendlyError[lang]:data.userFriendlyError.en:"";return window.tcart.emptyDeliveryServices=!0,tcart__errorHandler.show(userFriendlyError||data.error),citySearchInput.removeClass("load").attr("readonly",!1),void tcart__updateDelivery()}0===data.length?(window.tcart.emptyDeliveryServices=!0,that.deliveryState.activeServiceUid=null,tcart__errorHandler.show(t_delivery_dict("deliveryNotPossible")),citySearchInput.removeClass("load").attr("readonly",!1)):window.tcart.emptyDeliveryServices=!1,data.forEach((function(service,index){if(service.currency&&service.currency!==that.deliveryState.currencyCode){var searchInput;console.error(service.title+": wrong delivery currency ("+service.currency+")"),data.length===index+1&&($(".t706__cartwin-content .t706__product").css("pointer-events","unset"),$(".t706__cartwin-content .t-form__inputsbox").css("pointer-events","unset"),$(".t706 #city-searchbox input").removeClass("load").attr("readonly",!1))}else{that.deliveryState.services[service.id]={},that.deliveryState.services[service.id].fields=service.fields,that.deliveryState.services[service.id].strongAddress=service.strongAddress;var serviceHint=service.hint||"",label=service.title||"",serviceMinimumPrice=service.minimumPrice||"",description,checkedStatus=!1,freeDeliveryThreshold=service.freeDeliveryThreshold||"",dayString=that.declOfNum(service.minimumDeliverTime,[t_delivery_dict("day"),t_delivery_dict("days"),t_delivery_dict("days")]);service.staticPrice&&service.minimumDeliverTime?description=t_delivery_dict("from")+" "+service.minimumDeliverTime+" "+dayString+", "+tcart__showPrice(service.staticPrice):service.staticPrice?description=tcart__showPrice(service.staticPrice):service.minimumDeliverTime&&service.minimumPrice?description=t_delivery_dict("from")+" "+service.minimumDeliverTime+" "+dayString+", "+t_delivery_dict("from")+" "+tcart__showPrice(service.minimumPrice):service.minimumPrice?description=t_delivery_dict("from")+" "+tcart__showPrice(service.minimumPrice):service.minimumDeliverTime&&(description=t_delivery_dict("from")+" "+service.minimumDeliverTime+" "+dayString),"delivery"===service.type&&(serviceMinimumPrice="");var restrictions="";"n"===service.cash&&(restrictions+="cash"),0===index&&(checkedStatus=!0);var serviceItem=tcart_newDelivery.createRadio(label,description,serviceMinimumPrice,service.type,null,service.id,index,service.staticPrice||service.minimumPrice,serviceHint,service.hash,restrictions,checkedStatus,freeDeliveryThreshold);$("#delivery-services-wrapper").append(serviceItem)}})),tcart__updateDelivery(),tcart_newDelivery.changeDeliveryTypeListener(),$('#delivery-services-wrapper [checked="checked"]').trigger("change"),$(".t706__cartwin-content .t706__product").css("pointer-events","unset"),$(".t706__cartwin-content .t-form__inputsbox").css("pointer-events","unset"),tcart__showDeliveryPrice()}),(function(){if(that.deliveryState.badResponseCounters.services++,that.deliveryState.badResponseCounters.services<5)setTimeout((function(){that.renderServices(postalCode)}),1e3);else{tcart__preloader.hide();var cityInput=tcart_newDelivery.createInput("hidden","","","nodelivery",null,null,"","delivery-badresponse-comment",null,null,!0,"","deliveryreq");window.tcart&&(window.tcart.system="none");var message='<div style="margin: 20px 0; line-height: 22px; color: red;" class="t-text">'+t_delivery_dict("unavailable")+"</div>";wrapper.append(message),wrapper.append(cityInput)}}))},getCityFromGeo:function(projectId){var apiUrl="https://geoserv.tildacdn.com/api/detect-city/",dataObj={projectId:projectId};if(void 0===window.dev){var tCityFromGeo=sessionStorage.getItem("tCityFromGeo");if(null!==tCityFromGeo)try{return JSON.parse(tCityFromGeo)}catch(e){}}return dataObj=JSON.stringify(dataObj),$.ajax({type:"POST",url:apiUrl,dataType:"json",data:dataObj,success:function(data){void 0===window.dev&&sessionStorage.setItem("tCityFromGeo",JSON.stringify(data))},error:function(e){console.error(e)}})},getPayTypes:function(){var paytypes=$("#allrecords").data("tilda-paytypes");try{if(!paytypes||"object"!=typeof paytypes&&"function"!=typeof paytypes){if(paytypes={},$("input[name=paymentsystem]").each((function(){"cash"==$(this).val()?paytypes.cash="y":"banktransfer"==$(this).val()?paytypes.banktransfer="y":paytypes.card="y"})),!paytypes.card&&!paytypes.cash&&!paytypes.banktransfer){var paytype=$(".t706").eq(0).data("payment-system");"cash"==paytype?paytypes.cash="y":"banktransfer"==paytype?paytypes.banktransfer="y":paytype&&""!=paytype&&"none"!=paytype?paytypes.card="y":paytypes.none="y"}$("#allrecords").data("tilda-paytypes",paytypes)}}catch(e){}return paytypes},getServices:function(projectId,postalCode,currencyCode){var apiUrl="https://delivery.tildacdn.com/cart-api/";void 0!==window.tcart.products&&0!==window.tcart.products.length||void 0===window.tcart__syncProductsObject__LStoObj||void 0===window.tcart__updateTotalProductsinCartObj||(tcart__syncProductsObject__LStoObj(),tcart__updateTotalProductsinCartObj()),postalCode=postalCode||0;var geoData=this.deliveryState.geoData||{},itemsCount=window.tcart.total||0,cartAmount=window.tcart.prodamount_withdiscount||window.tcart.prodamount||0,products=[];$.each(window.tcart.products,(function(index,product){$.isEmptyObject(product)||"yes"===product.deleted||products.push(product)}));var paytypes=this.getPayTypes();if(void 0===itemsCount||itemsCount<1)return{error:new Error("RU"===window.tildaBrowserLang?"добавьте в корзину хотя бы один товар":"add at least one product")};var dataObj={action:"list",projectId:projectId,postalCode:postalCode,currency:currencyCode,itemsCount:itemsCount,cartAmount:cartAmount,geoData:geoData,products:products,paytypes:paytypes};return dataObj=JSON.stringify(dataObj),tcart__preloader.show($("#delivery-services-wrapper"),t_delivery_dict("loadingServices")),tcart__hideDeliveryPrice(),$.ajax({type:"POST",url:apiUrl,data:dataObj,dataType:"json",success:function(){tcart__preloader.hide()},error:function(e){console.error(e)}})},getPickupList:function(projectId,postalCode,deliveryId,pattern){var apiUrl="https://delivery.tildacdn.com/cart-api/";void 0!==window.tcart.products&&0!==window.tcart.products.length||void 0===window.tcart__syncProductsObject__LStoObj||void 0===window.tcart__updateTotalProductsinCartObj||(tcart__syncProductsObject__LStoObj(),tcart__updateTotalProductsinCartObj()),postalCode=postalCode||0;var geoData=this.deliveryState.geoData||{},itemsCount=window.tcart.total||0,cartAmount=window.tcart.prodamount_withdiscount||window.tcart.prodamount||0,products=[];$.each(window.tcart.products,(function(index,product){$.isEmptyObject(product)||"yes"===product.deleted||products.push(product)}));var paytypes=this.getPayTypes();if(void 0===itemsCount||itemsCount<1)return{error:new Error("RU"===window.tildaBrowserLang?"добавьте в корзину хотя бы один товар":"add at least one product")};var dataObj={action:"pickup-list",projectId:projectId,postalCode:postalCode,deliveryId:deliveryId,pattern:pattern,itemsCount:itemsCount,cartAmount:cartAmount,geoData:geoData,products:products,paytypes:paytypes};return dataObj=JSON.stringify(dataObj),$.ajax({type:"POST",url:apiUrl,data:dataObj,dataType:"json",success:function(){},error:function(e){console.error(e)}})},getDeliveryPrice:function(projectId,postalCode,serviceId,pickupPointId){tcart__hideDeliveryPrice();var apiUrl="https://delivery.tildacdn.com/cart-api/";void 0!==window.tcart.products&&0!==window.tcart.products.length||void 0===window.tcart__syncProductsObject__LStoObj||void 0===window.tcart__updateTotalProductsinCartObj||(tcart__syncProductsObject__LStoObj(),tcart__updateTotalProductsinCartObj());var itemsCount=window.tcart.total||0;if(void 0===itemsCount||itemsCount<1)return{error:new Error("RU"===window.tildaBrowserLang?"добавьте в корзину хотя бы один товар":"add at least one product")};var cartAmount=window.tcart.prodamount_withdiscount||window.tcart.prodamount||0,products=[];$.each(window.tcart.products,(function(index,product){$.isEmptyObject(product)||"yes"===product.deleted||products.push(product)}));var guid=this.deliveryState.cityGuid||0;""!=postalCode&&0!=postalCode||window.send_js_error_delivery({name:"Delivery postalCode",message:this.deliveryState});var dataObj={action:"calculate",projectId:projectId,postalCode:postalCode,deliveryId:serviceId,currency:this.deliveryState.currencyCode,itemsCount:itemsCount,cartAmount:cartAmount,pickupPointId:pickupPointId,products:products,guid:guid};return dataObj=JSON.stringify(dataObj),$.ajax({type:"POST",url:apiUrl,data:dataObj,dataType:"json",success:function(){},error:function(e){console.error(e)}})},getCityCoordinates:function(mapType,city){var apiUrl="https://geocode-maps.yandex.ru/1.x/?apikey="+this.deliveryState.ymapApiKey+"&format=json&geocode="+city;return $.ajax({type:"GET",url:apiUrl,dataType:"json",success:function(){},error:function(e){console.error(e)}})},getAddresses:function(data,type){var apiURL,that=this;this.deliveryState.currentRequest&&that.deliveryState.currentRequest.abort();var apiURL={street:"https://geoserv.tildacdn.com/api/address/",city:"https://geoserv.tildacdn.com/api/city/",pickup:"https://delivery.tildacdn.com/cart-api/",house:"https://geoserv.tildacdn.com/api/house/"};try{var json=JSON.parse(data),pattern="t"+type+"_"+json.pattern;if(void 0!==json.fias&&(pattern+="_"+json.fias),void 0===window.dev){var tDataFromGeo=sessionStorage.getItem(pattern);if(null!==tDataFromGeo)try{return JSON.parse(tDataFromGeo)}catch(e){}}}catch(e){}return this.deliveryState.currentRequest=$.ajax({type:"POST",url:apiURL[type]||"",data:data,dataType:"json",success:function(data){that.deliveryState.currentRequest=null,void 0===window.dev&&sessionStorage.setItem(pattern,JSON.stringify(data))},error:function(){that.deliveryState.currentRequest=null}}),this.deliveryState.currentRequest},createInput:function(inputType,label,placeholder,defaultValue,inputId,serviceId,classes,name,hidden,groupStyle,isRequired,inputMode,tildaRule){placeholder=placeholder||"",defaultValue=defaultValue||"",isRequired=isRequired?1:0;var str="";return str+="<div "+(groupStyle?'style="'+groupStyle+'"':"")+" "+(hidden?"hidden":"")+' class="t-input-group t-input-group_in" data-input-lid="">',str+='<div class="t-input-title t-descr t-descr_md" data-redactor-toolbar="no" field="">'+(label=label||"")+"</div>",str+='<div class="t-input-block">',str+='<input class="js-tilda-rule '+(classes=classes+" t-input"||"t-input")+'"'+((tildaRule=tildaRule||"")?' data-tilda-rule="'+tildaRule+'"':"")+((inputMode=inputMode||"")?' inputmode="'+inputMode+'"':"")+((inputType=inputType||"")?' type="'+inputType+'"':"")+' data-service-id="'+(serviceId=serviceId||"")+'"'+((inputId=inputId||"")?' id="'+inputId+'"':"")+' name="'+name.toLowerCase()+'" value="'+defaultValue+'" placeholder="'+placeholder+'" autocomplete="'+(navigator.userAgent.search(/Chrome/)>0?"no":"off")+'" data-tilda-req="'+isRequired+'" />',str+=' <svg class="t706__search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 88 88"><path fill="#3f3f3f" d="M85 31.1c-.5-8.7-4.4-16.6-10.9-22.3C67.6 3 59.3 0 50.6.6c-8.7.5-16.7 4.4-22.5 11-11.2 12.7-10.7 31.7.6 43.9l-5.3 6.1-2.5-2.2-17.8 20 9 8.1 17.8-20.2-2.1-1.8 5.3-6.1c5.8 4.2 12.6 6.3 19.3 6.3 9 0 18-3.7 24.4-10.9 5.9-6.6 8.8-15 8.2-23.7zM72.4 50.8c-9.7 10.9-26.5 11.9-37.6 2.3-10.9-9.8-11.9-26.6-2.3-37.6 4.7-5.4 11.3-8.5 18.4-8.9h1.6c6.5 0 12.7 2.4 17.6 6.8 5.3 4.7 8.5 11.1 8.9 18.2.5 7-1.9 13.8-6.6 19.2z"></svg>',str+='<div class="t-input-clear"></div>',str+='<div class="t-input-description t-text t-text_xs" style="color: #505050; margin: 5px 0 0;"></div>',str+='<div class="t-input-error"></div>',str+="</div>",str+="</div>"},createRadio:function(label,description,minimumPrice,deliveryType,classes,serviceId,index,staticPrice,hint,hash,restrictions,checkedStatus,freeDeliveryThreshold){label=label||"",description=description||"",minimumPrice=minimumPrice||"",hint=hint||"",checkedStatus&&(checkedStatus='checked="checked"');var str="";str+='<label class="'+(classes=classes?classes+" t-radio__control t-text t-text_xs":"t-radio__control t-text t-text_xs")+'" '+(serviceId?'data-service-id="'+serviceId+'"':"")+">";var tmp="<input "+((restrictions=restrictions||"")?'data-restrictions="'+restrictions+'"':"")+((freeDeliveryThreshold=freeDeliveryThreshold||"")?'data-free-delivery-threshold="'+freeDeliveryThreshold+'"':"")+((hash=hash||"")?'data-hash-value="'+hash+'"':"")+"  "+(staticPrice?'data-static-price="'+staticPrice+'"':"")+" "+(staticPrice?'data-delivery-price="'+staticPrice+'"':'data-delivery-price=""')+" "+checkedStatus+' data-service-id="'+serviceId+'"type="radio" data-delivery-type='+deliveryType+' name="tildadelivery-type" value=""class="t-radio t-radio_delivery js-tilda-rule" data-tilda-req="1">',tmpDOM=jQuery.parseHTML(tmp);return $(tmpDOM).attr("value",label),""!==hint&&$(tmpDOM).attr("data-hint-text",hint),str+=$(tmpDOM)[0].outerHTML,str+='<div class="t-radio__indicator" style="border-color:#000000"></div>',str+='<span class="delivery-checkbox-label">'+label+" </span>",str+='<span class="delivery-minimum">'+description+" </span>",str+="</label>"},createTitle:function(label,classes){var str="";return str+='<div class="t-name t-name_md'+(classes=classes||"")+'" style="margin: 20px 0;">'+(label=label||"")+"</div>"},createSelect:function(label,classes,options,pickupServiceId,name){label=label||"",classes=classes||"";var str="";return str+='<label class="t-input-title t-descr t-descr_md">Пункт выдачи</label>',str+='<div class="ss-select delivery-pickup-select">',str+='<select class="ss-input ss-select delivery-select" data-service-id="'+pickupServiceId+'" name="'+(name=name||"")+'">',str+='<option data-point-id="">Не выбран</option>',options.forEach((function(option){str+="<option data-point-id="+option.id+">"+option.address+"</option>"})),str+="</select>",str+="</div>"},changeDeliveryTypeListener:function(){var that=this;$("input[data-delivery-type]").change((function(){var serviceUid=parseInt($(this).attr("data-service-id"),10)||0,freeDeliveryThreshold=parseInt($(this).attr("data-free-delivery-threshold"),10);that.deliveryState.freeDeliveryThreshold=freeDeliveryThreshold||0,that.deliveryState.activeServiceUid=serviceUid,tcart__errorHandler.hide(),that.renderAddressFields(this),this.dataset.hashValue&&that.setHashInput(this.dataset.hashValue),that.hidePaymentMethod(this),$("input[data-delivery-type]").each((function(index,input){$(input).attr("data-static-price")>0?$(input).attr("data-delivery-price",$(input).attr("data-static-price")):$(input).attr("data-delivery-price","")})),that.hints.deleteAll(),that.deliveryState.fullNames.pickup=null,that.deliveryState.fullNames.street=null,that.deliveryState.fullNames.house=null,that.deliveryState.searchboxes["pickup-searchbox"]&&(that.deliveryState.searchboxes["pickup-searchbox"]=null),$(this).attr("data-hint-text")&&that.hints.render($(this).attr("data-hint-text")),tcart__updateDelivery()}))},hidePaymentMethod:function(control){var cashControl=$(".t706").find("[data-payment-variant-system='cash']"),cashControlParent=$(".t706").find("[data-payment-variant-system='cash']").parent(),paymentWrapper,firstControl=cashControlParent.closest(".t-radio__wrapper-payment").find("[data-payment-variant-system]").not("[data-payment-variant-system='cash']").first();"cash"===control.dataset.restrictions&&cashControl.length?(cashControlParent.hide(),firstControl.prop("checked",!0),firstControl.trigger("change")):cashControlParent.show()},removePriceValueInRadio:function(serviceId){$('.t706 input[data-service-id="'+serviceId+'"]').removeAttr("data-delivery-price"),tcart__updateDelivery(),tcart__hideDeliveryPrice()},updatePriceValueInRadio:function(priceValue,serviceId){$('.t706 input[data-service-id="'+serviceId+'"]').attr("data-delivery-price",priceValue),tcart__updateDelivery(),tcart__showDeliveryPrice()},changePickupHandler:function(id,name,postalCode,searchbox,pickupAddress,coordinates){var searchInput=$(searchbox).find(".searchbox-input"),serviceId=searchInput.attr("data-service-id"),that=this;if(postalCode=postalCode||this.deliveryState.city.postalCode,searchInput.attr("data-pickup-id",id),searchInput.attr("data-pickup-address",pickupAddress),searchInput.val(name),$.when(that.getDeliveryPrice(that.deliveryState.projectId,postalCode,serviceId,id)).done((function(data){var servicePrice=data.price;if(data.error||0===data.length){var lang=window.tildaBrowserLang.toLowerCase(),userFriendlyError=data.userFriendlyError?data.userFriendlyError[lang]?data.userFriendlyError[lang]:data.userFriendlyError.en:"";return data.error&&tcart__errorHandler.show(userFriendlyError||data.error),window.tcart.emptyDeliveryServices=!0,void tcart__updateDelivery()}window.tcart.emptyDeliveryServices=!1,tcart__errorHandler.hide(),void 0!==data.hash&&that.setHashInput(data.hash),id||(servicePrice=0),that.updatePriceValueInRadio(servicePrice,serviceId),that.setFullAddress(that.getFullAddress())})).fail((function(){var error="";error="RU"===window.browserLang?'Невозможно получить почтовый индекс для доставки. Пожалуйста, перезагрузите страницу и попробуйте еще раз. Если ситуация не изменилась, обратитесь в поддержку <a href="mailto:team@tilda.cc?subject=Unable to get a pickup" style="color:#fff;text-decoration:underline;">team@tilda.cc</a>.':'Unable to get a postal code for delivery. Please reload the page and try again. If the situation has not changed, please contact support <a href="mailto:team@tilda.cc?subject=Unable to get a pickup" style="color:#fff;text-decoration:underline;">team@tilda.cc</a>.',tcart__errorHandler.show("Request failed: "+error),window.tcart.emptyDeliveryServices=!0,tcart__updateDelivery()})),coordinates)var isCoordinatesEmpty=0==coordinates[0]&&0==coordinates[1];coordinates&&window.deliveryMap&&!isCoordinatesEmpty&&window.deliveryMap.setCenter(coordinates,16)},renderAddressFields:function(element){this.disableChoseServiceControls();var that=this,wrapper=$(".t-radio__wrapper-delivery").first();$("#addresses-wrapper").length>0&&$("#customdelivery").attr("data-service-id")!==$(element).attr("data-service-id")&&$("#addresses-wrapper").remove(),$("#customdelivery").attr("data-service-id",$(element).attr("data-service-id"));var deliveryAddressesWrapper=document.createElement("div");deliveryAddressesWrapper.id="addresses-wrapper",wrapper.append(deliveryAddressesWrapper);var deliveryType=$(element).attr("data-delivery-type"),deliveryServiceId=$(element).attr("data-service-id"),searchInput=$(".t706 #city-searchbox input");switch(deliveryType){case"pickup":tcart__preloader.show($("#addresses-wrapper"),t_delivery_dict("loadingPickup")),window.tcart.emptyDeliveryServices=!1,$.when(that.getPickupList(that.deliveryState.projectId,that.deliveryState.city.postalCode,deliveryServiceId)).done((function(data){if(data.error){var lang=window.tildaBrowserLang.toLowerCase(),userFriendlyError=data.userFriendlyError?data.userFriendlyError[lang]?data.userFriendlyError[lang]:data.userFriendlyError.en:"";return tcart__errorHandler.show(userFriendlyError||data.error),window.tcart.emptyDeliveryServices=!0,tcart__preloader.hide(),that.enableChoseServiceControls(),searchInput.removeClass("load").attr("readonly",!1),void tcart__updateDelivery()}tcart__preloader.hide();var pickupInput=that.createInput("",t_delivery_dict("pickup"),t_delivery_dict("selectPickup"),null,null,deliveryServiceId,"searchbox-input js-tilda-rule","tildadelivery-pickup-name",null,null,!0,null,"chosevalue"),searchBox=that.createSearchbox(pickupInput,"pickup-searchbox");$("#addresses-wrapper").append(searchBox.outerHTML),that.deliveryState.searchboxes["pickup-searchbox"]={},that.deliveryState.searchboxes["pickup-searchbox"].autocompleteAddress=data,that.deliveryState.pickupList=data,that.deliveryState.ymapApiKey&&that.mapInit("yandex"),that.searchboxInit("pickup-searchbox","pickup",null,data),that.renderUserFields(deliveryAddressesWrapper,deliveryServiceId),that.changeCartInputsHandler();var searchboxNode=$(".t706 #pickup-searchbox");that.deliveryState.ymapApiKey&&that.mapAddPoints("",data,searchboxNode),that.enableChoseServiceControls(),searchInput.removeClass("load").attr("readonly",!1)}));break;case"delivery":window.tcart.emptyDeliveryServices=!1,that.renderUserFields(deliveryAddressesWrapper,deliveryServiceId),that.changeCartInputsHandler(),that.enableChoseServiceControls(),searchInput.removeClass("load").attr("readonly",!1)}},clearHouseInput:function(){$('.t706 #customdelivery [name="tildadelivery-house"]').val("")},renderUserFields:function(wrapper,deliveryServiceId){var fields=this.deliveryState.services[deliveryServiceId].fields,smallSizeFieldsCount=0;for(var k in fields)switch(k){case"street":case"comment":case"userInitials":break;default:smallSizeFieldsCount++}var counter=0;for(var fieldKey in fields){var autocomplete=fields[fieldKey].autocomplete,inputLabel="",inputGroupStyle="",inputType="",inputMode="",inputPlaceholder="",inputRequired=!0;switch(fieldKey){case"street":inputLabel=t_delivery_dict("street"),inputGroupStyle="width: 100%";break;case"house":counter++,inputLabel=t_delivery_dict("house");break;case"entrance":counter++,inputLabel=t_delivery_dict("entrance"),inputType="number",inputMode="numeric",inputRequired=!1;break;case"floor":counter++,inputLabel=t_delivery_dict("floor"),inputType="number",inputMode="numeric",inputRequired=!1;break;case"aptOffice":counter++,inputLabel=t_delivery_dict("apt"),inputRequired=!1;break;case"phone":counter++,inputLabel=t_delivery_dict("phone"),inputType="number",inputMode="numeric";break;case"entranceCode":counter++,inputLabel=t_delivery_dict("entranceCode"),inputRequired=!1;break;case"comment":inputLabel=t_delivery_dict("comment"),inputGroupStyle="width: 100%",inputRequired=!1,inputPlaceholder=t_delivery_dict("orderComment");break;case"oneLineAddress":counter++,inputLabel=t_delivery_dict("address");break;case"userInitials":inputGroupStyle="width: 100%",inputLabel=t_delivery_dict("fullName"),inputPlaceholder=t_delivery_dict("johnDoe")}smallSizeFieldsCount===counter&&smallSizeFieldsCount%2!=0&&(inputGroupStyle="width: 100%"),inputLabel=inputLabel||"";var inputName="tildadelivery-"+fieldKey,tildaRule="";if(autocomplete){tildaRule="chosevalue","house"===fieldKey&&(tildaRule="");var inputWithAutocomplete=tcart_newDelivery.createInput(inputType,inputLabel,inputPlaceholder,"","",deliveryServiceId,"searchbox-input js-tilda-rule",inputName,!1,inputGroupStyle,inputRequired,inputMode,tildaRule),searchboxId=fieldKey+"-searchbox",searchbox=this.createSearchbox(inputWithAutocomplete,searchboxId);$(wrapper).append(searchbox),this.searchboxInit(searchboxId,fieldKey)}else{"userInitials"===fieldKey&&(tildaRule="name");var input=tcart_newDelivery.createInput(inputType,inputLabel,inputPlaceholder,"","",deliveryServiceId,"js-tilda-rule",inputName,!1,inputGroupStyle,inputRequired,inputMode,tildaRule);$(wrapper).append(input)}}this.restoreTcartDelivery()},hints:{render:function(hintText){var deliveryServicesWrapper=$("#delivery-services-wrapper"),hintElem=document.createElement("div");$(hintElem).attr("id","delivery-hint").addClass("delivery-hint t-text t-text_xs"),hintElem.innerHTML=hintText,$(deliveryServicesWrapper).after(hintElem)},deleteAll:function(){$(".delivery-hint").length&&$(".delivery-hint").remove()}}},tcart__errorHandler={show:function(error){var all=$(".t706 .js-errorbox-all"),string=$(".t706 .t-form__errorbox-item.js-rule-error-string");void 0!==error&&""!==error&&string.html(error),""!==string.text()&&(all.css("display","block"),string.css("display","block"))},hide:function(){var all=$(".t706 .js-errorbox-all"),string=$(".t706 .t-form__errorbox-item.js-rule-error-string");all.css("display","none"),string.css("display","none")}},tcart__inputErrorHandler={show:function(input,errorText){var inputWrapper=input.closest(".t-input-group"),inputError;inputWrapper.find(".t-input-error").html(errorText),inputWrapper.addClass("js-error-control-box")},hide:function(input){var inputWrapper=input.closest(".t-input-group"),inputError;inputWrapper.find(".t-input-error").html(""),inputWrapper.removeClass("js-error-control-box")}};function tcart__hideDeliveryPrice(){$(".t706__cartwin-totalamount-info").length&&$(".t706__cartwin-totalamount-info").css("opacity","0"),$(".t706 .delivery-full-address").length&&$(".t706 .delivery-full-address").css("opacity","0")}function tcart__showDeliveryPrice(){$(".t706__cartwin-totalamount-info").length&&$(".t706__cartwin-totalamount-info").css("opacity","1"),$(".t706 .delivery-full-address").length&&$(".t706 .delivery-full-address").css("opacity","1")}var tcart__preloader={show:function(elementForBefore,loadMessage){if(elementForBefore.length&&!elementForBefore.parent().find(".tcart__preloader").length){var str="";str+='<div class="tcart__preloader" style="margin: 20px 0;">',loadMessage&&(str+='<div class="t-text" style="text-align: center; opacity: .5; font-size: 15px;">'+loadMessage+"</div>"),str+='<div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>',str+="</div>",elementForBefore.before(str)}},hide:function(){$(".tcart__preloader").remove()}};function arraysEqual(a,b){if(a===b)return!0;if(null==a||null==b)return!1;if(a.length!=b.length)return!1;for(var i=0;i<a.length;++i)if(a[i]!==b[i])return!1;return!0}function tcart__rerenderDeliveryServices(){clearTimeout(window.rerenderTimer),window.rerenderTimer=setTimeout((function(){$(".t706__cartwin-content .t706__product").css("pointer-events","none"),$(".t706__cartwin-content .t-form__inputsbox").css("pointer-events","none");var needRender=!1,deliveryState=tcart_newDelivery.deliveryState,deliveryServices=deliveryState.services,activeServiceUid=deliveryState.activeServiceUid,that=tcart_newDelivery;if(!activeServiceUid)return $(".t706__cartwin-content .t706__product").css("pointer-events","unset"),void $(".t706__cartwin-content .t-form__inputsbox").css("pointer-events","unset");var serviceUidsFromCard=[],serviceUidsFromServer=[];if(Object.keys(deliveryServices).forEach((function(key){serviceUidsFromCard.push(parseInt(key,10))})),deliveryState.projectId>0||(deliveryState.projectId=parseInt($("#allrecords").attr("data-tilda-project-id"),10)),deliveryState.projectId>0||1!==$("#t-header").length||(deliveryState.projectId=parseInt($("#t-header").attr("data-tilda-project-id"),10)),deliveryState.projectId>0||1!==$("#t-footer").length||(deliveryState.projectId=parseInt($("#t-footer").attr("data-tilda-project-id"),10)),deliveryState.projectId>0||1!==$("#tildacopy").length||(deliveryState.projectId=parseInt(($("#tildacopy").attr("data-tilda-sign")||"").split("#")[0],10)),!(deliveryState.projectId>0)){var error="";return error="RU"===window.browserLang?'Невозможно получить сервисы доставок. Пожалуйста, перезагрузите страницу и попробуйте еще раз. Если ситуация не изменилась, обратитесь в поддержку <a href="mailto:team@tilda.cc?subject=Unable to get delivery services" style="color:#fff;text-decoration:underline;">team@tilda.cc</a>.':'Unable to get a delivery services. Please reload the page and try again. If the situation has not changed, please contact support <a href="mailto:team@tilda.cc?subject=Unable to get delivery services" style="color:#fff;text-decoration:underline;">team@tilda.cc</a>.',tcart__errorHandler.show(error),window.tcart.emptyDeliveryServices=!0,void tcart__updateDelivery()}$.when(tcart_newDelivery.getServices(deliveryState.projectId,deliveryState.cityPostalCode,deliveryState.currencyCode)).then((function(data){var postalCode;(Array.isArray(data)&&data.forEach((function(serviceFromServer){serviceUidsFromServer.push(serviceFromServer.id)})),serviceUidsFromCard.sort((function(a,b){return a-b})),serviceUidsFromServer.sort((function(a,b){return a-b})),needRender=!arraysEqual(serviceUidsFromServer,serviceUidsFromCard)&&!serviceUidsFromServer.includes(activeServiceUid))?(tcart_newDelivery.renderServices(deliveryState.postalCode),$(".t706__cartwin-content .t706__product").css("pointer-events","unset"),$(".t706__cartwin-content .t-form__inputsbox").css("pointer-events","unset")):($(".t706 #delivery-services-wrapper").find(".t-radio__control").each((function(index,element){$(element).remove()})),Array.isArray(data)&&data.forEach((function(service,index){if(service.currency&&service.currency!==that.deliveryState.currencyCode)console.error(service.title+": wrong delivery currency ("+service.currency+")");else{that.deliveryState.services[service.id]={},that.deliveryState.services[service.id].fields=service.fields,that.deliveryState.services[service.id].strongAddress=service.strongAddress;var serviceHint=service.hint||"",label=service.title||"",serviceMinimumPrice=service.minimumPrice||"",description,freeDeliveryThreshold=service.freeDeliveryThreshold||"",dayString=that.declOfNum(service.minimumDeliverTime,[t_delivery_dict("day"),t_delivery_dict("days"),t_delivery_dict("days")]);service.staticPrice&&service.minimumDeliverTime?description=t_delivery_dict("from")+" "+service.minimumDeliverTime+" "+dayString+", "+tcart__showPrice(service.staticPrice):service.staticPrice?description=tcart__showPrice(service.staticPrice):service.minimumDeliverTime&&service.minimumPrice?description=t_delivery_dict("from")+" "+service.minimumDeliverTime+" "+dayString+", "+t_delivery_dict("from")+" "+tcart__showPrice(service.minimumPrice):service.minimumPrice?description=t_delivery_dict("from")+" "+tcart__showPrice(service.minimumPrice):service.minimumDeliverTime&&(description=t_delivery_dict("from")+" "+service.minimumDeliverTime+" "+dayString),"delivery"===service.type&&(serviceMinimumPrice="");var restrictions="";"n"===service.cash&&(restrictions+="cash");var checkedStatus=!1;service.id===activeServiceUid&&(checkedStatus=!0);var serviceItem=tcart_newDelivery.createRadio(label,description,serviceMinimumPrice,service.type,null,service.id,index,service.staticPrice||service.minimumPrice,serviceHint,service.hash,restrictions,checkedStatus,freeDeliveryThreshold);$("#delivery-services-wrapper").append(serviceItem)}})),postalCode="object"==typeof deliveryState.postalCode?deliveryState.cityPostalCode:deliveryState.postalCode,$.when(tcart_newDelivery.getDeliveryPrice(deliveryState.projectId,postalCode,activeServiceUid)).done((function(data){if(data.error?window.tcart.emptyDeliveryServices=!0:(window.tcart.emptyDeliveryServices=!1,tcart__errorHandler.hide()),void 0!==data.hash&&tcart_newDelivery.setHashInput(data.hash),void 0!==data.price){var servicePrice=data.price;tcart_newDelivery.updatePriceValueInRadio(servicePrice,activeServiceUid)}tcart__updateDelivery(),tcart_newDelivery.changeDeliveryTypeListener(),$(".t706__cartwin-content .t706__product").css("pointer-events","unset"),$(".t706__cartwin-content .t-form__inputsbox").css("pointer-events","unset"),tcart__showDeliveryPrice()})).fail((function(){var error="";error="RU"===window.browserLang?'Невозможно получить почтовый индекс для доставки. Пожалуйста, перезагрузите страницу и попробуйте еще раз. Если ситуация не изменилась, обратитесь в поддержку <a href="mailto:team@tilda.cc?subject=Unable to get active service" style="color:#fff;text-decoration:underline;">team@tilda.cc</a>.':'Unable to get a postal code for delivery. Please reload the page and try again. If the situation has not changed, please contact support <a href="mailto:team@tilda.cc?subject=Unable to get active service" style="color:#fff;text-decoration:underline;">team@tilda.cc</a>.',tcart__errorHandler.show("Request failed: "+error),window.tcart.emptyDeliveryServices=!0,tcart__updateDelivery()})))}))}),500)}function t_delivery_dict(msg){var dict=[];dict.address={EN:"Address",RU:"Адрес",FR:"Adresse",DE:"Adresse",ES:"Dirección",PT:"Endereço",JA:"住所",ZH:"地址",UK:"Адреса",PL:"Adres",KK:"Мекен-жай",IT:"Indirizzo",LV:"Adrese"},dict.city={EN:"City",RU:"Город",FR:"Ville",DE:"Stadt",ES:"Ciudad",PT:"Cidade",JA:"市",ZH:"城市",UK:"Місто",PL:"Miasto",KK:"Қала",IT:"Città",LV:"Pilsēta"},dict.street={EN:"Street",RU:"Улица",FR:"Rue",DE:"Straße",ES:"Calle",PT:"Rua",JA:"通り",ZH:"街道",UK:"Вулиця",PL:"Ulica",KK:"Көше",IT:"Strada",LV:"Iela"},dict.house={EN:"House",RU:"Дом",FR:"Loger",DE:"Haus",ES:"Edificio №",PT:"Lar",JA:"家",ZH:"屋",UK:"Будинок",PL:"Budynek",KK:"Үй",IT:"Casa",LV:"Māja"},dict.entrance={EN:"Entrance",RU:"Подъезд",FR:"Entrée",DE:"Eingang",ES:"Entrada",PT:"Entrada",JA:"エントランス",ZH:"入口",UK:"Під’їзд",PL:"Wejście",KK:"Кіру",IT:"Ingresso",LV:"Ieeja"},dict.floor={EN:"Floor",RU:"Этаж",FR:"Étage",DE:"Fußboden",ES:"Planta",PT:"Andar",JA:"床",ZH:"地面",UK:"Поверх",PL:"Piętro",KK:"Еден",IT:"Pavimento",LV:"Stāvs"},dict.apt={EN:"Apt/office",RU:"Квартира/офис",FR:"Apt/bureau",DE:"Apt/Büro",ES:"Piso/oficina",PT:"Apt/escritório",JA:"アプト/オフィス",ZH:"公寓/办公室",UK:"Квартира/офіс",PL:"Mieszkanie/lokal",KK:"Пәтер/кеңсе",IT:"Abitazione/ufficio",LV:"Dzīvoklis/birojs"},dict.phone={EN:"Phone",RU:"Телефон",FR:"Téléphoner",DE:"Telefon",ES:"Teléfono",PT:"Telefone",JA:"電話",ZH:"电话",UK:"Телефон",PL:"Telefon",KK:"Телефон",IT:"Telefono",LV:"Tālrunis"},dict.phones={EN:"Phones",RU:"Телефоны",FR:"Téléphones",DE:"Telefone",ES:"Telefonos",PT:"Telefones",JA:"電話",ZH:"手机",UK:"Телефони",PL:"Telefony",KK:"Телефондар",IT:"Cellulari",LV:"Telefoni"},dict.entranceCode={EN:"Entrance code",RU:"Домофон",FR:"Code d'entrée",DE:"Zugangscode",ES:"Código de entrada",PT:"Código de entrada",JA:"エントランスコード",ZH:"入口代码",UK:"Домофон",PL:"Domofon",KK:"Түсу коды",IT:"Codice d'ingresso",LV:"Ieejas kods"},dict.comment={EN:"Comment",RU:"Комментарий",FR:"Commenter",DE:"Kommentar",ES:"Comentario",PT:"Comente",JA:"コメント",ZH:"评论",UK:"Коментар",PL:"Komentarz",KK:"Түсініктеме",IT:"Commento",LV:"Komentāri"},dict.day={EN:"day",RU:"дня",FR:"journée",DE:"tag",ES:"día",PT:"dia",JA:"日",ZH:"日",UK:"дні",PL:"dzień",KK:"күн",IT:"giorno",LV:"diena"},dict.days={EN:"days",RU:"дней",FR:"journées",DE:"Tage",ES:"dias",PT:"dias",JA:"日々",ZH:"天",UK:"днів",PL:"dzień",KK:"күн",IT:"giorni",LV:"dienas"},dict.from={EN:"from",RU:"от",FR:"de",DE:"von",ES:"de",PT:"de",JA:"から",ZH:"从",UK:"від",PL:"od",KK:"бастап",IT:"da",LV:"no"},dict.deliveryNotPossible={EN:"Unfortunately, delivery to your chosen city is not possible",RU:"К сожалению, в выбранный вами город доставка не осуществляется",FR:"Malheureusement, la livraison à votre ville choisie n'est pas possible",DE:"Leider ist eine Lieferung in der gewählten Stadt nicht möglich",ES:"Por desgracia, la entrega a su ciudad elegida no es posible",PT:"Infelizmente, a entrega à sua cidade escolhida não é possível",JA:"残念ながら、あなたの選ばれた都市への配信を行うことはできません",ZH:"不幸的是，送货到你所选择的城市是不可能的",UK:"На жаль, в обране місто доставка не здійснюється",PL:"Niestety nie dostarczamy w wybrane przez ciebie miejsce",KK:"Өкінішке орай, Сіздің таңдаған қалаға жеткізу мүмкін емес",IT:"Purtroppo, la consegna al vostro città scelta non è possibile",LV:"Diemžēl piegāde uz jūsu izvēlēto pilsētu netiek veikta"},dict.delivery={EN:"Delivery",RU:"Доставка",FR:"Livraison",DE:"Lieferung",ES:"Entrega",PT:"Entrega",JA:"配達",ZH:"交货",UK:"Доставка",PL:"Dostawa",KK:"Жеткізілім",IT:"Consegna",LV:"Piegāde"},dict.pickup={EN:"Pickup location",RU:"Пункт получения",FR:"Lieu de ramassage",DE:"Treffpunkt",ES:"Lugar de recogida",PT:"Local de retirada",JA:"ピックアップ場所",ZH:"接人的地方",UK:"Пункт отримання",PL:"Miejsce odbioru",KK:"Жеткізу орны",IT:"Posto di raccolta",LV:"Saņemšanas punkts"},dict.selectPickup={EN:"Select pickup location",RU:"Выберите пункт получения",FR:"Sélectionnez l'emplacement pick-up",DE:"Wählen Sie Abholort",ES:"Seleccionar ubicación de recogida",PT:"Escolha local de retirada",JA:"ピックアップ場所を選択",ZH:"选择的取货地点",UK:"Виберіть пункт отримання",PL:"Wybierz miejsce odbioru",KK:"Желімді орынды таңдаңыз",IT:"Seleziona ubicazione pickup",LV:"Izvēlieties pikaps atrašanās vietu"},dict.selectAddress={EN:"Please select an address from the options provided",RU:"Пожалуйста, выберите адрес из предложенных вариантов",FR:"S'il vous plaît sélectionner une adresse parmi les options proposées",DE:"Bitte wählen Sie eine Adresse aus den Optionen zur Verfügung gestellt",ES:"Por favor, seleccione una dirección de una de las opciones proporcionadas",PT:"Por favor seleccione um endereço entre as opções fornecidas",JA:"提供されるオプションからアドレスを選択してください",ZH:"请从所提供的选项的地址",UK:"Будь ласка, виберіть адресу із запропонованих варіантів",PL:"Wybierz adres wśród oferowanych opcji",KK:"Берілген параметрлерден мекенжайды таңдаңыз",IT:"Si prega di selezionare un indirizzo tra le opzioni previste",LV:"Lūdzu, izvēlieties adresi no piedāvātajām iespējām"},dict.selectCity={EN:"Please select an city from the options provided",RU:"Пожалуйста, выберите город из предложенных вариантов",FR:"S'il vous plaît choisir une ville parmi les options proposées",DE:"Bitte wählen Sie eine Stadt aus den Optionen zur Verfügung gestellt",ES:"Por favor, seleccione una ciudad de entre las opciones proporcionadas",PT:"Por favor, selecione uma cidade entre as opções fornecidas",JA:"提供されるオプションから都市を選択してください",ZH:"请从所提供的选项的城市",UK:"Будь ласка, виберіть місто із запропонованих варіантів",PL:"Wybierz miejsce wśród oferowanych opcji",KK:"Берілген параметрлерден бір қаланы таңдаңыз",IT:"Si prega di selezionare una città tra le opzioni previste",LV:"Lūdzu, izvēlieties pilsētu no piedāvātajām iespējām"},dict.orderComment={EN:"Order comment",RU:"Комментарий к заказу",FR:"Commentaire de commande",DE:"Bestellen Kommentar",ES:"Comentario de la orden",PT:"Comentário ordem",JA:"注文のコメント",ZH:"为了评论",UK:"Коментар до замовлення",PL:"Komentarz do zamówienia",KK:"Тапсырыс беру қатынасқа",IT:"Commento Order",LV:"Komentējiet pasūtījumu"},dict.select={EN:"Select",RU:"Выбрать",FR:"Sélectionner",DE:"Wählen",ES:"Seleccione",PT:"Selecionar",JA:"選択する",ZH:"选择",UK:"Вибрати",PL:"Wybierz",KK:"Таңдаңыз",IT:"Selezionare",LV:"Izvēlieties"},dict.workingHours={EN:"Working hours",RU:"Время работы",FR:"Heures d'ouverture",DE:"Arbeitszeit",ES:"Horas Laborales",PT:"Jornada de trabalho",JA:"勤務時間",ZH:"工作时间",UK:"Час роботи",PL:"Godziny robocze",KK:"Жұмыс сағаттары",IT:"Ore lavorative",LV:"Darba stundas"},dict.unavailable={EN:"Delivery service temporarily unavailable.",RU:"К сожалению, в данный момент сервис доставки недоступен.",FR:"Service de livraison temporairement indisponible.",DE:"Zustelldienst vorübergehend nicht verfügbar.",ES:"Servicio de entrega disponible temporalmente.",PT:"Serviço de entrega temporariamente indisponíveis.",JA:"配達サービスが一時的に利用できません。",ZH:"送货服务暂时不可用。",UK:"Служба доставки тимчасово не працює.",PL:"Niestety, w tym momencie dostawa nie jest możliwa.",KK:"Жеткізу қызметі уақытша қол жетімсіз.",IT:"Servizio di consegna temporaneamente non disponibile.",LV:"Diemžēl piegādes pakalpojums pašlaik nav pieejams."},dict.loadingServices={EN:"Loading delivery services",RU:"Получение сервисов доставки",FR:"Services de livraison de chargement",DE:"Laden Zustelldienste",ES:"Servicios Carga de entrega",PT:"Serviços de carga de entrega",JA:"ローディング配信サービス",ZH:"加载送货服务",UK:"Отримання сервісів доставки",PL:"Otrzymanie serwisów dostawy",KK:"Жеткізу қызметтері жүктелуде",IT:"Servizi di consegna Caricamento",LV:"Piegādes pakalpojumu saņemšana"},dict.loadingPickup={EN:"Loading a list of pickup locations",RU:"Получение списка пунктов выдачи заказов",FR:"Chargement d'une liste d'emplacements pick-up",DE:"Laden einer Liste von Standorten pickup",ES:"Carga de una lista de los lugares de recogida",PT:"Carregando uma lista de locais de coleta",JA:"ピックアップ場所のリストを読み込みます",ZH:"加载接客位置的列表",UK:"Отримання списку пунктів видачі замовлень",PL:"Otrzymanie listy miejsc wydania zamówień",KK:"Желімді орындардың тізімін жүктеу",IT:"Caricamento di un elenco di luoghi di ritiro",LV:"Saņemšanas punktu saraksta iegūšana"},dict.noResult={EN:"No results were found for your request",RU:"По вашему запросу ничего не найдено",FR:"Aucun résultat n'a été trouvé pour votre demande",DE:"Es wurden keine Ergebnisse für Ihre Anfrage gefunden",ES:"No se encontraron resultados para su solicitud",PT:"Não foram encontrados resultados para sua solicitação",JA:"該当する結果はあなたの要求のために見つかりませんでした",ZH:"没有找到您的要求",UK:"За вашим запитом нічого не знайдено",PL:"Brak wyników",KK:"Нәтижелері Сіздің сұранысыңыз бойынша табылған жоқ",IT:"Non sono stati trovati risultati per la tua richiesta",LV:"Jūsu meklēšanas vaicājumam netika atrasts neviens rezultāts"},dict.change={EN:"Change",RU:"Изменить",FR:"Changer",DE:"Veränderung",ES:"Cambio",PT:"Mudar",JA:"変化する",ZH:"改变",UK:"Змінити",PL:"Zmień",KK:"Өзгеріс",IT:"Modificare",LV:"Rediģēt"},dict.fullName={EN:"Full name",RU:"Получатель (ФИО полностью)",FR:"Nom et prénom",DE:"Vollständiger Name",ES:"Nombre completo",PT:"Nome completo",JA:"フルネーム",ZH:"全名",UK:"Одержувач (ПІБ повністю)",PL:"Pełne imię",KK:"Толық аты",IT:"Nome e cognome",LV:"Saņēmējs (pilns vārds)"},dict.johnDoe={EN:"John Doe",RU:"Иванов Иван Иванович",FR:"Jean Dupont",DE:"Max Mustermann",ES:"Fulano de Tal",PT:"Fulano de Tal",JA:"なになに",ZH:"张三",UK:"Іван Іванович Іваненко",PL:"Jan Kowalski",KK:"Алмаз Ахметов",IT:"Mario Rossi",LV:"John Doe"};var lang=window.browserLang;return void 0!==dict[msg]?void 0!==dict[msg][lang]&&""!=dict[msg][lang]?dict[msg][lang]:dict[msg].EN:"Text not found #"+msg}window.send_js_error_delivery=function(data){if(void 0!==data&&"string"==typeof data.message){var xhr=new XMLHttpRequest;xhr.open("POST","https://sysstat.tildacdn.com/api/js/error/",!0),xhr.setRequestHeader("Content-Type","application/json"),xhr.send(JSON.stringify({account_id:"deliv",event_id:window.uuid4(),request:{url:window.location.href},exception:{values:[{type:"string"==typeof data.name?data.name:"undefined",value:data.message,stacktrace:{frames:"string"!=typeof data.filename?[]:[{filename:data.filename,colno:0,lineno:0}]}}]},stacktrace:void 0!==data.stack?data.stack:""}))}};