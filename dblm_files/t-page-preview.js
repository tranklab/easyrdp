function t__pagepreview__init(){var t=window.location.href.split("?")[1].split("&")[0].split("=")[1],i=window.location.hash.split("_")[1],n=-1!==window.location.href.indexOf("preview"),e=window===window.parent;window.tpagepreviewfontsize=[];var r={res_320:"480px",res_480:"320px",res_640:"960px",res_1024:"768px",res_max:"100%"};n?0===window.location.hash.length&&e&&(t__pagepreview__drawPanel(t),null!==document.getElementById("t-page-preview-back")&&document.getElementById("t-page-preview-back").remove(),document.querySelector('.pe-preview__res-btn[data-preview-res="max"]').classList.add("pe-preview__res-btn_open")):(t__pagepreview__addIframe(t,i,r["res_"+i]),t__pagepreview__drawPanel(t),setTimeout(function e(){void 0===document.getElementById("iframe").contentWindow.t__pagepreview__changeCoverFontSize?setTimeout(e,200):document.getElementById("iframe").contentWindow.t__pagepreview__changeCoverFontSize(i)}),document.querySelector('.pe-preview__res-btn[data-preview-res="'+i+'"]').classList.add("pe-preview__res-btn_open")),$("body").on("mouseenter",".pe-preview__res-btn_open",function(){t__pagepreview__openPanel($(this))}),$("body").on("mouseleave",".pe-preview__res-wrapper-btn_active",function(){t__pagepreview__closePanel()}),document.querySelectorAll(".pe-preview__res-wrapper-btn .pe-preview__res-btn").forEach(function(e){e.addEventListener("click",function(){t__pagepreview__switchBetweenRes(this,i,n,t,r)}),e.addEventListener("mouseenter",function(){var e=this.parentNode.getBoundingClientRect().y,t=this.getBoundingClientRect().x;document.body.insertAdjacentHTML("afterend",t__pagepreview__addTooltip(this,this.getAttribute("data-preview-res-interval"),e,t))}),e.addEventListener("mouseleave",function(){document.querySelector(".pe-preview__tooltip").remove()})}),window.isPagePreview=!0}function t__pagepreview__addIframe(t,e,i){document.body.innerHTML='<div class="pe-preview__container"></div>',document.querySelector(".pe-preview__container").innerHTML='<iframe id="iframe" data-preview-iframe-res="res_'+e+'" data-preview-iframe-height="'+i+'" src="https://tilda.cc/page/preview/?pageid='+t+'&previewmode=yes"></iframe>',iframeURLChange(document.getElementById("iframe"),function(e){console.log("URL changed:",e),e!=="https://tilda.cc/page/preview/?pageid="+t+"&previewmode=yes"&&"about:blank"!==e&&(window.location.href=e)}),t__pagepreview__hideScrollOnMobile(e),t__pagepreview__setIframeHeight(e)}function t__pagepreview__setIframeHeight(e){var t=parent.document.body.clientHeight,i=document.querySelector('#iframe[data-preview-iframe-res="res_'+e+'"]');null!==i&&(e=parseInt(i.getAttribute("data-preview-iframe-height")),i.style.height=t<e+45?t-45:e)}function t__pagepreview__hideScrollOnMobile(e){var t=document.querySelector('#iframe[data-preview-iframe-res="res_'+e+'"]');"max"!==e&&setTimeout(function e(){null===t.contentDocument.querySelector("#allrecords")?setTimeout(e,100):t.contentDocument.head.innerHTML=t.contentDocument.head.innerHTML+"<style>html{overflow: scroll;}::-webkit-scrollbar{width:0px;background:transparent;}</style>"})}function t__pagepreview__switchBetweenRes(e,t,i,n,r){t=e.getAttribute("data-preview-res"),i&&(i=document.getElementById("allrecords").getAttribute("data-tilda-project-id"),history.replaceState({},"","https://tilda.cc/page/responsive/?pageid="+n+"&projectid="+i+"#res_"+t),location.reload()),document.querySelectorAll(".pe-preview__res-btn").forEach(function(e){e.classList.remove("pe-preview__res-btn_active")}),e.classList.add("pe-preview__res-btn_active"),t__pagepreview__switchBetweenMobileAndDesktop(t,r["res_"+t]),t__pagepreview__setIframeHeight(t),t__pagepreview__hideScrollOnMobile(t),setTimeout(function(){document.getElementById("iframe").contentWindow.t__pagepreview__changeCoverFontSize(t),document.getElementById("iframe").contentWindow.document.querySelectorAll(".t-cover").forEach(function(e){document.getElementById("iframe").contentWindow.t__pagepreview__fixCoverContentHeight($(e).parent().attr("id").substr("3"))})},500)}function t__pagepreview__openPanel(e){$(".pe-preview__res-wrapper-btn").addClass("pe-preview__res-wrapper-btn_active"),$(".pe-preview__res-btn_open").removeClass("pe-preview__res-btn_open"),$(".pe-preview__res-btn").show(),e.addClass("pe-preview__res-btn_active")}function t__pagepreview__closePanel(){$(".pe-preview__res-btn:not(.pe-preview__res-btn_active)").hide(),$(".pe-preview__res-wrapper-btn").removeClass("pe-preview__res-wrapper-btn_active"),$(".pe-preview__res-btn_active").addClass("pe-preview__res-btn_open"),$(".pe-preview__res-btn_active").removeClass("pe-preview__res-btn_active")}function t__pagepreview__drawPanel(e){var t="";t+='<div class="pe-preview__wrapper">',t+='<div class="pe-preview__btn">',t+='<a href="/page/?pageid='+e+'">',t+="RU"===document.body.getAttribute("data-lang")?"Вернуться к редактированию":"Back to editing",t+="</a>",t+="</div>",t+='<div class="pe-preview__res-wrapper-btn">',t+='<span class="pe-preview__res-btn" data-preview-res="320" data-preview-res-interval="320">',t+='<svg width="10" height="16" viewBox="0 0 10 16" fill="none" xmlns="http://www.w3.org/2000/svg">',t+='<path fill-rule="evenodd" clip-rule="evenodd" d="M2.027 15.44a1.62 1.62 0 01-1.619-1.623V1.623C.408.727 1.14 0 2.027 0h5.701a1.62 1.62 0 011.62 1.623v12.194c0 .897-.732 1.623-1.62 1.623H2.027zm.006-3.25V2.288h5.689v9.902H2.033zm3.657 1.625a.813.813 0 10-1.625 0 .813.813 0 001.625 0z" fill="#fff"/>',t+="</svg>",t+="</span>",t+='<span class="pe-preview__res-btn" data-preview-res="480" data-preview-res-interval="480">',t+='<svg width="16" height="9" viewBox="0 0 16 9" fill="none" xmlns="http://www.w3.org/2000/svg">',t+='<path fill-rule="evenodd" clip-rule="evenodd" d="M.527 1.619A1.62 1.62 0 012.151 0h12.193c.897 0 1.623.732 1.623 1.619V7.32a1.62 1.62 0 01-1.623 1.619H2.151A1.625 1.625 0 01.527 7.32V1.62zm3.25.006h9.903v5.689H3.778V1.625zM2.154 5.282a.813.813 0 100-1.625.813.813 0 000 1.625z" fill="#fff"/>',t+="</svg>",t+="</span>",t+='<span class="pe-preview__res-btn" data-preview-res="640" data-preview-res-interval="640">',t+='<svg width="16" height="22" viewBox="0 0 16 22" fill="none" xmlns="http://www.w3.org/2000/svg">',t+='<path fill-rule="evenodd" clip-rule="evenodd" d="M1.573 21.956C.786 21.956.148 21.3.148 20.5V1.457C.148.653.793 0 1.573 0h12.15c.788 0 1.425.658 1.425 1.458v19.04c0 .805-.644 1.458-1.424 1.458H1.574zm.004-3.66V1.465H13.72v16.833H1.577zm7.143 1.83c0-.606-.48-1.097-1.072-1.097-.591 0-1.071.491-1.071 1.097 0 .607.48 1.098 1.071 1.098.592 0 1.072-.491 1.072-1.098z" fill="#fff"/>',t+="</svg>",t+="</span>",t+='<span class="pe-preview__res-btn" data-preview-res="1024" data-preview-res-interval="1024">',t+='<svg width="23" height="15" viewBox="0 0 23 15" fill="none" xmlns="http://www.w3.org/2000/svg">',t+='<path fill-rule="evenodd" clip-rule="evenodd" d="M0 1.425C0 .638.673 0 1.494 0h19.512c.825 0 1.494.645 1.494 1.425v12.15c0 .787-.673 1.425-1.494 1.425H1.494C.669 15 0 14.355 0 13.575V1.425zm3.75.004H21V13.57H3.75V1.43zM1.875 8.57C2.496 8.571 3 8.091 3 7.5c0-.592-.504-1.071-1.125-1.071S.75 6.909.75 7.5c0 .592.504 1.071 1.125 1.071z" fill="#fff"/>',t+="</svg>",t+="</span>",t+='<span class="pe-preview__res-btn" data-preview-res="max" data-preview-res-interval="max">',t+='<svg width="35" height="21" viewBox="0 0 35 21" fill="none" xmlns="http://www.w3.org/2000/svg">',t+='<path d="M32.06 21H2.932c-1.496 0-2.71-.303-2.71-.677 0-.375 1.214-.678 2.71-.678H32.06c1.496 0 2.71.303 2.71.678 0 .374-1.214.677-2.71.677z" fill="#fff"/>',t+='<mask id="a" fill="#fff">',t+='<path fill-rule="evenodd" clip-rule="evenodd" d="M2.932 1.36C2.932.609 3.54 0 4.288 0h26.415c.749 0 1.356.609 1.356 1.36v15.57c0 .75-.608 1.36-1.356 1.36H4.288a1.358 1.358 0 01-1.356-1.36V1.36zm1.354-.005h26.418v15.58H4.286V1.355z"/>',t+="</mask>",t+='<path fill-rule="evenodd" clip-rule="evenodd" d="M2.932 1.36C2.932.609 3.54 0 4.288 0h26.415c.749 0 1.356.609 1.356 1.36v15.57c0 .75-.608 1.36-1.356 1.36H4.288a1.358 1.358 0 01-1.356-1.36V1.36zm1.354-.005h26.418v15.58H4.286V1.355z" fill="#fff"/>',t+='<path d="M4.286 1.355v-191h-191v191h191zm26.418 0h191v-191h-191v191zm0 15.58v191h191v-191h-191zm-26.418 0h-191v191h191v-191zM193.932 1.36C193.932 105.727 109.394 191 4.288 191v-382c-106.602 0-192.356 86.49-192.356 192.36h382zM4.288 191h26.415v-382H4.288v382zm26.415 0C-74.49 191-158.941 105.639-158.941 1.36h382c0-105.782-85.665-192.36-192.356-192.36v382zM-158.941 1.36v15.57h382V1.36h-382zm0 15.57c0-104.368 84.538-189.641 189.644-189.641v382c106.602 0 192.356-86.49 192.356-192.36h-382zM30.703-172.711H4.288v382h26.415v-382zm-26.415 0c105.193 0 189.644 85.361 189.644 189.64h-382c0 105.782 85.665 192.36 192.356 192.36v-382zm189.644 189.64V1.36h-382v15.57h382zM4.286 192.356h26.418v-382H4.286v382zm-164.582-191v15.58h382V1.355h-382zm191-175.42H4.286v382h26.418v-382zm164.582 191V1.355h-382v15.58h382z" fill="#fff" mask="url(#a)"/>',t+="</svg>",t+="</span>",t+="</div>",t+="</div>",document.body.insertAdjacentHTML("beforeend",t)}function iframeURLChange(e,t){function i(){t(e.contentWindow.location.href)}function n(){e.contentWindow.removeEventListener("unload",i),e.contentWindow.addEventListener("unload",i)}e.addEventListener("load",n),n()}function t__pagepreview__switchBetweenMobileAndDesktop(e,t){"max"!==e?(window.isMobile=!0,t__pagepreview__changeRes(e,t)):(window.isMobile=!1,t__pagepreview__changeRes("max",t))}function t__pagepreview__changeRes(e,t){var i=document.getElementById("iframe");null!==i&&(i.setAttribute("data-preview-iframe-res","res_"+e),i.setAttribute("data-preview-iframe-height",t)),history.replaceState({},"","#res_"+e)}function t__pagepreview__addTooltip(e,t,i,n){return'<div class="pe-preview__tooltip'+("max"===t?" pe-preview__tooltip_max":"")+'" style="top:'+(i-45)+"px;left:"+(n+e.clientWidth/2)+'px;">'+("max"!==t?t+"px":"max")+"</div>"}function t__pagepreview__fixCoverContentHeight(e){var t=$("#rec"+e),i=t.find(".t-cover__carrier").attr("data-content-cover-height"),n=t.find(".t-cover").height(),r=t.find("div[data-hook-content]").outerHeight(),e=t.find(".t-cover__carrier"),n=-1!==i.indexOf("vh")?$(window).height()*(parseInt(i,10)/100):parseInt(i,10);if(300<r&&n<r+40){if(1e3<(r+=120)&&(r+=100),t__pagepreview__setCoverHeight(t,e,r),"function"==typeof window.t_lazyload_updateResize_elem)try{window.t_lazyload_updateResize_elem(t.find(".t-cover__carrier"))}catch(e){console.log("error:"+e)}}else t__pagepreview__setCoverHeight(t,e,n)}function t__pagepreview__setCoverHeight(e,t,i){e.find(".t-cover").height(i),e.find(".t-cover__filter").height(i),e.find(".t-cover__carrier").height(i),e.find(".t-cover__wrapper").height(i),0==window.isMobile&&0<t.find("iframe").length&&t__pagepreview__setWidthHeightYoutubeVideo(t,i+"px")}function t__pagepreview__changeCoverFontSize(e){var t=$("div[data-customstyle=yes], [field] span").length;$("div[data-customstyle=yes], [field] span").each(function(){window.tpagepreviewfontsize.length<t&&window.tpagepreviewfontsize.push($(this).css("font-size").replace("px",""))}),"320"===e?t__pagepreview__setFontSize(26):"480"===e||"640"===e?t__pagepreview__setFontSize(30):$("div[data-customstyle=yes], [field] span").each(function(e){$(this).css("font-size",window.tpagepreviewfontsize[e]+"px")})}function t__pagepreview__setFontSize(i){$("div[data-customstyle=yes], [field] span").each(function(e){var t=$(this);window.tpagepreviewfontsize[e]>i&&t.css("font-size").replace("px","")>i?(t.css("font-size",""),t.is("div")&&t.css("line-height","")):window.tpagepreviewfontsize[e]<=i&&t.css("font-size",window.tpagepreviewfontsize[e]+"px")})}function t__pagepreview__setWidthHeightYoutubeVideo(e,t){var i,n,r,a,o=e.find("iframe"),p=e.attr("data-content-video-nocover"),s=e.attr("data-content-video-noadcut-youtube"),_=e.attr("data-content-video-ratio"),d=.5625;0<_&&(d=+parseFloat(_)),"yes"!=p?(r=-1<(t=t||"100vh").indexOf("vh")?(n=(n=window.innerHeight)||$(window).height(),Math.floor(n*(parseInt(t)/100))):parseInt(t),_=i=(a=(a=Math.floor(parseInt(window.innerWidth)))||$(window).width())*d,p=i,n=1,"yes"!==s&&(_=_+110+110,p=i-220),p<r&&(n=i<r?r/i+.02:i/r+.02),p=Math.floor(a*n),r=(n=Math.floor(_*n))-r,a=p-a,o.height(n+"px"),o.width(p+"px"),0<r&&o.css("margin-top",-Math.floor(r/2)+"px"),0<a&&o.css("margin-left",-Math.floor(a/2)+"px")):(t||(i=Math.floor(e.width()*d)),t&&-1<t.indexOf("vh")?i=Math.floor(window.innerHeight*(parseInt(t)/100)):t&&(i=parseInt(t)),o.css("width","100%"),o.height(i+"px"))}$(document).ready(function(){void 0===window.isPagePreview&&t__pagepreview__init()});
